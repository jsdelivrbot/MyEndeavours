<?xml version="1.0" encoding="UTF-8" ?>
<?oracle-xsl-mapper
  <!-- SPECIFICATION OF MAP SOURCES AND TARGETS, DO NOT MODIFY. -->
  <mapSources>
    <source type="WSDL">
      <schema location="ETH_DEQJMS_CustomChangePO.wsdl"/>
      <rootElement name="CustomChangePO" namespace="http://xmlns.emrsn.com/CustomChangePurchaseOrder"/>
    </source>
  </mapSources>
  <mapTargets>
    <target type="WSDL">
      <schema location="ETHSys_IntegrationServices_ETHSysGrp_B2BInOut_ETH_ChangePO_CustomEDI_5020_850_RemoveNamespace_RS.wsdl"/>
      <rootElement name="CustomEDI850" namespace="http://xmlns.emrsn.com/CustomEDI850"/>
    </target>
  </mapTargets>
  <!-- GENERATED BY ORACLE XSL MAPPER 10.1.3.4.0(build 080718.0645) AT [FRI APR 16 15:30:31 IST 2010]. -->
?>
<xsl:stylesheet version="1.0"
                xmlns:ns5="http://www.openapplications.org/oagis/9/unqualifieddatatypes/1.1"
                xmlns:plt="http://schemas.xmlsoap.org/ws/2003/05/partner-link/"
                xmlns:ehdr="http://www.oracle.com/XSL/Transform/java/oracle.tip.esb.server.headers.ESBHeaderFunctions"
                xmlns:ns1="http://www.openapplications.org/oagis/9/IANAMIMEMediaTypes:2003"
                xmlns:jca="http://xmlns.oracle.com/pcbpel/wsdl/jca/"
                xmlns:ns0="http://www.w3.org/2001/XMLSchema"
                xmlns:xp20="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.Xpath20"
                xmlns:ora="http://schemas.oracle.com/xpath/extension"
                xmlns:orcl="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.ExtFunc"
                xmlns:hdr="http://xmlns.oracle.com/pcbpel/adapter/file/"
                xmlns:ns6="http://www.openapplications.org/oagis/9/unitcode/66411:2001"
                xmlns:ns8="http://www.openapplications.org/oagis/9/languagecode/5639:1988"
                xmlns:ns11="http://xmlns.emrsn.com/CustomProcessPurchaseOrder"
                xmlns:bpws="http://schemas.xmlsoap.org/ws/2003/03/business-process/"
                xmlns:imp1="http://xmlns.emrsn.com/CustomChangePurchaseOrder"
                xmlns:pc="http://xmlns.oracle.com/pcbpel/"
                xmlns:ns4="http://www.openapplications.org/oagis/9/qualifieddatatypes/1.1"
                xmlns:ns7="http://www.openapplications.org/oagis/9/currencycode/54217:2001"
                xmlns:tns="http://xmlns.oracle.com/pcbpel/adapter/file/Read/"
                xmlns:hwf="http://xmlns.oracle.com/bpel/workflow/xpath"
                xmlns:ns2="http://www.openapplications.org/oagis/9/codelists"
                xmlns:xref="http://www.oracle.com/XSL/Transform/java/oracle.tip.xref.xpath.XRefXPathFunctions"
                xmlns:ns9="http://xmlns.oracle.com/pcbpel/adapter/file/Write/"
                xmlns:ns10="urn:oracle:integration:b2b:DCC1FCD2811C47748DF43A39F735F4F0"
                xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
                xmlns:ids="http://xmlns.oracle.com/bpel/services/IdentityService/xpath"
                xmlns:ns3="http://www.openapplications.org/oagis/9"
                exclude-result-prefixes="xsl ns5 plt ns1 jca ns0 hdr ns6 ns8 imp1 pc ns4 ns7 tns ns2 ns3 ns11 ns9 ns10 ehdr xp20 ora orcl bpws hwf xref ids">
  <xsl:template match="/">   
     <ns11:CustomEDI850>
       <xsl:variable name="SC_SeqNo">  
        <xsl:value-of select="orcl:sequence-next-val('B2B_MSG_SEQ','jdbc/ETH_BusinessDB')"/>
      </xsl:variable>
      <xsl:variable name="Current_Time">  
        <xsl:value-of select="xp20:current-time()"/>
      </xsl:variable>
      <xsl:variable name="destination">
        <xsl:choose>
            <xsl:when test="/imp1:CustomChangePO/Attribute5 ='TP1'">        
                <xsl:value-of select="/imp1:CustomChangePO/Trading_partner_1_name"/>
            </xsl:when>
            <xsl:when test="/imp1:CustomChangePO/Attribute5 ='TP2'">
                <xsl:value-of select="/imp1:CustomChangePO/Trading_partner_2_name"/>
            </xsl:when> 
            <xsl:when test="/imp1:CustomChangePO/Attribute5 ='TP3'">
                <xsl:value-of select="/imp1:CustomChangePO/Trading_partner_3_name"/>
            </xsl:when> 
            <xsl:when test="/imp1:CustomChangePO/Attribute5 ='TP4'">
                <xsl:value-of select="/imp1:CustomChangePO/Logistics_1_name"/>
            </xsl:when> 
            <xsl:when test="/imp1:CustomChangePO/Attribute5 ='TP5'">
                <xsl:value-of select="/imp1:CustomChangePO/Logistics_2_name"/>
            </xsl:when>
            <xsl:otherwise>
                <xsl:value-of select="string('Invalid')"/>
            </xsl:otherwise>
        </xsl:choose>
     </xsl:variable>
      
      <xsl:variable name="Var_InterchangeSenderQual">  
        <xsl:value-of select="orcl:lookup-dvm('ISA_GS_IDs','TradingPartner',$destination,'InterchangeSenderQual','ZZ')"/>
      </xsl:variable>
      <xsl:variable name="Var_InterchangeSenderID">  
        <xsl:value-of select="orcl:lookup-dvm('ISA_GS_IDs','TradingPartner',$destination,'InterchangeSenderID','EMR')"/>
      </xsl:variable> 
      <xsl:variable name="Var_InterchangeReceiverQual">  
        <xsl:value-of select="orcl:lookup-dvm('ISA_GS_IDs','TradingPartner',$destination,'InterchangeReceiverQual','ZZ')"/>
      </xsl:variable> 
      <xsl:variable name="Var_InterchangeReceiverID">  
        <xsl:value-of select="orcl:lookup-dvm('ISA_GS_IDs','TradingPartner',$destination,'InterchangeReceiverID','SeeBeyond')"/>
      </xsl:variable> 
      <xsl:variable name="Var_InterchangeUsageIndicator">  
        <xsl:value-of select="orcl:lookup-dvm('ISA_GS_IDs','TradingPartner',$destination,'InterchangeUsageIndicator','P')"/>
      </xsl:variable> 
      <xsl:variable name="Var_GroupSenderID">  
        <xsl:value-of select="orcl:lookup-dvm('ISA_GS_IDs','TradingPartner',$destination,'GroupSenderID','EMR')"/>
      </xsl:variable> 
      <xsl:variable name="Var_GroupReceiverID">  
        <xsl:value-of select="orcl:lookup-dvm('ISA_GS_IDs','TradingPartner',$destination,'GroupReceiverID','SeeBeyond')"/>
      </xsl:variable> 
      
    <ns10:Transaction-850>
      <xsl:variable name="Current_date">  
        <xsl:value-of select="xp20:current-date()"/>
      </xsl:variable>
      <xsl:attribute name="XDataVersion">
        <xsl:value-of select='string("1.0")'/>
      </xsl:attribute>
      <xsl:attribute name="Standard">
        <xsl:value-of select='string("X12")'/>
      </xsl:attribute>
      <xsl:attribute name="GUID">
        <xsl:value-of select='string("{D4791971-A782-D811-B0F2-080020C8C860}")'/>
      </xsl:attribute>
      <xsl:attribute name="CreatedBy">
        <xsl:value-of select='string("ECXEngine_899")'/>
      </xsl:attribute>
      <xsl:attribute name="CreatedDate"> <!--ADDED AS ON 17 OCT -->
        <xsl:value-of select="xp20:current-dateTime()"/>
      </xsl:attribute>

    <ns10:Internal-Properties>
          <ns10:Data-Structure>
            <xsl:attribute name="Name">
              <xsl:value-of select='string("Interchange")'/>
            </xsl:attribute>
            <ns10:Lookup>
              <xsl:attribute name="Name">
                <xsl:value-of select='string("InterchangeSenderQual")'/>
              </xsl:attribute>
              <xsl:value-of select='$Var_InterchangeSenderQual'/>
            </ns10:Lookup>
            <ns10:Lookup>
              <xsl:attribute name="Name">
                <xsl:value-of select='string("InterchangeSenderID")'/>
              </xsl:attribute>
              <xsl:value-of select='$Var_InterchangeSenderID'/>
            </ns10:Lookup>
            <ns10:Lookup>
                <xsl:attribute name="Name">
                    <xsl:value-of select='string("InterchangeReceiverQual")'/>
                </xsl:attribute>                    
                <xsl:value-of select='$Var_InterchangeReceiverQual'/>
            </ns10:Lookup>
            <ns10:Lookup>
              <xsl:attribute name="Name">
                <xsl:value-of select='string("InterchangeReceiverID")'/>
              </xsl:attribute>
              <xsl:value-of select='$Var_InterchangeReceiverID'/>
            </ns10:Lookup>
           <ns10:Lookup>
              <xsl:attribute name="Name">
                <xsl:value-of select='string("InterchangeControlVersion")'/>
              </xsl:attribute>
              <xsl:value-of select='string("00502")'/>
            </ns10:Lookup>
            <ns10:Lookup>
              <xsl:attribute name="Name">
                <xsl:value-of select='string("Standard")'/>
              </xsl:attribute>
              <xsl:value-of select='string("X12")'/>
            </ns10:Lookup>
            <ns10:Property>
              <xsl:attribute name="Name">
                <xsl:value-of select='string("InterchangeAuthorizationInfoQual")'/>
              </xsl:attribute>
              <xsl:value-of select='string("00")'/>
            </ns10:Property>
            <ns10:Property>
              <xsl:attribute name="Name">
                <xsl:value-of select='string("InterchangeAuthorizationInfo")'/>
              </xsl:attribute>
              <xsl:value-of select='string("")'/>
            </ns10:Property>
            <ns10:Property>
              <xsl:attribute name="Name">
                <xsl:value-of select='string("InterchangeSecurityInfoQual")'/>
              </xsl:attribute>
              <xsl:value-of select='string("00")'/>
            </ns10:Property>
            <ns10:Property>
              <xsl:attribute name="Name">
                <xsl:value-of select='string("InterchangeSecurityInfo")'/>
              </xsl:attribute>
              <xsl:value-of select='string("")'/>
            </ns10:Property>
            <ns10:Property>
              <xsl:attribute name="Name">
                <xsl:value-of select='string("InterchangeSenderQual")'/>
              </xsl:attribute>
              <xsl:value-of select='$Var_InterchangeSenderQual'/>
            </ns10:Property>
            <ns10:Property>
              <xsl:attribute name="Name">
                <xsl:value-of select='string("InterchangeSenderID")'/>
              </xsl:attribute>
              <xsl:value-of select='$Var_InterchangeSenderID'/>
            </ns10:Property>
            <ns10:Property>
                <xsl:attribute name="Name">
                    <xsl:value-of select='string("InterchangeReceiverQual")'/>
                </xsl:attribute>                    
                <xsl:value-of select='$Var_InterchangeReceiverQual'/>
            </ns10:Property>
            <ns10:Property>
              <xsl:attribute name="Name">
                <xsl:value-of select='string("InterchangeReceiverID")'/>
              </xsl:attribute>
              <xsl:value-of select='$Var_InterchangeReceiverID'/>
            </ns10:Property>
           <ns10:Property>
              <xsl:attribute name="Name">
                <xsl:value-of select='string("InterchangeDate")'/>
              </xsl:attribute>
              <xsl:value-of select="concat(substring($Current_date,3.0,2.0),substring($Current_date,6.0,2.0),substring($Current_date,9.0,2.0))"/>
            </ns10:Property>
            <ns10:Property>
              <xsl:attribute name="Name">
                <xsl:value-of select='string("InterchangeTime")'/>
              </xsl:attribute> 
            
              <xsl:value-of select="concat(substring($Current_Time,1.0,2.0),substring($Current_Time,4.0,2.0))"/>
            </ns10:Property>
            <ns10:Property>
              <xsl:attribute name="Name">
                <xsl:value-of select='string("InterchangeControlStandard_RepeatingSeparator")'/>
              </xsl:attribute>
              <xsl:value-of select='string("&lt;")'/>
            </ns10:Property>
            <ns10:Property>
              <xsl:attribute name="Name">
                <xsl:value-of select='string("InterchangeControlVersion")'/>
              </xsl:attribute>
              <xsl:value-of select='string("00502")'/>
            </ns10:Property>
            <ns10:Property>
              <xsl:attribute name="Name">
                <xsl:value-of select='string("InterchangeControlNumber")'/>
              </xsl:attribute>
              <xsl:value-of select="$SC_SeqNo"/>
            </ns10:Property>
            <ns10:Property>
              <xsl:attribute name="Name">
                <xsl:value-of select='string("InterchangeAckRequested")'/>
              </xsl:attribute>
              <xsl:value-of select='string("0")'/>
            </ns10:Property>
            <ns10:Property>
              <xsl:attribute name="Name">
                <xsl:value-of select='string("InterchangeUsageIndicator")'/>
              </xsl:attribute>
              <xsl:value-of select='$Var_InterchangeUsageIndicator'/>
            </ns10:Property>
            <ns10:Property>
              <xsl:attribute name="Name">
                <xsl:value-of select='string("InterchangeComponentElementSep")'/>
              </xsl:attribute>
              <xsl:value-of select='string("0x3e")'/>
            </ns10:Property>
            <ns10:Property>
              <xsl:attribute name="Name">
                <xsl:value-of select='string("DecimalSeparator")'/>
              </xsl:attribute>
              <xsl:value-of select='string("")'/>
            </ns10:Property>
            <ns10:Property>
              <xsl:attribute name="Name">
                <xsl:value-of select='string("ElementDelimiter")'/>
              </xsl:attribute>
              <xsl:value-of select='string("0x7c")'/>
            </ns10:Property>
            <ns10:Property>
              <xsl:attribute name="Name">
                <xsl:value-of select='string("ReleaseCharacter")'/>
              </xsl:attribute>
              <xsl:value-of select='string("")'/>
            </ns10:Property>
            <ns10:Property>
              <xsl:attribute name="Name">
                <xsl:value-of select='string("RepeatingSeparator")'/>
              </xsl:attribute>
              <xsl:value-of select='string("0x3c")'/>
            </ns10:Property>
            <ns10:Property>
              <xsl:attribute name="Name">
                <xsl:value-of select='string("SegmentDelimiter")'/>
              </xsl:attribute>
              <xsl:value-of select='string("0x7e0xd0xa")'/>
            </ns10:Property>
            <ns10:Property>
              <xsl:attribute name="Name">
                <xsl:value-of select='string("SubelementDelimiter")'/>
              </xsl:attribute>
              <xsl:value-of select='string("0x3e")'/>
            </ns10:Property>
            <ns10:Property>
              <xsl:attribute name="Name">
                <xsl:value-of select='string("InterchangeChildCount")'/>
              </xsl:attribute>        
              <xsl:value-of select='count(/imp1:CustomChangePO/ChangePO/DataArea/ns3:PurchaseOrder)'/>
            </ns10:Property>
            <ns10:Property>
              <xsl:attribute name="Name">
                <xsl:value-of select='string("InterchangeTrailerControlNumber")'/>
              </xsl:attribute>
              <xsl:value-of select="$SC_SeqNo"/>
            </ns10:Property> 
               <ns10:Data-Structure>
              <xsl:attribute name="Name">
                <xsl:value-of select='string("Group")'/>
              </xsl:attribute>
              <ns10:Lookup>
                <xsl:attribute name="Name">
                  <xsl:value-of select='string("GroupSenderID")'/>
                </xsl:attribute>
                <xsl:value-of select='$Var_GroupSenderID'/>
              </ns10:Lookup>
              <ns10:Lookup>
              <xsl:attribute name="Name">
                <xsl:value-of select='string("GroupReceiverID")'/>
              </xsl:attribute>
              <xsl:value-of select='$Var_GroupReceiverID'/>
            </ns10:Lookup>
              <ns10:Lookup>
                <xsl:attribute name="Name">
                  <xsl:value-of select='string("GroupVersionNumber")'/>
                </xsl:attribute>
                <xsl:value-of select='string("005020")'/>
              </ns10:Lookup>
              <ns10:Property>
                <xsl:attribute name="Name">
                  <xsl:value-of select='string("GroupID")'/>
                </xsl:attribute>
                <xsl:value-of select='string("PO")'/>
              </ns10:Property>
              <ns10:Property>
                <xsl:attribute name="Name">
                  <xsl:value-of select='string("GroupSenderID")'/>
                </xsl:attribute>
                <!--<xsl:value-of select='$Var_GroupSenderID'/>-->
                <xsl:value-of select="/imp1:CustomChangePO/ChangePO/ns3:ApplicationArea/ns3:Sender/ns3:LogicalID"/>
              </ns10:Property>
              <ns10:Property>
              <xsl:attribute name="Name">
                <xsl:value-of select='string("GroupReceiverID")'/>
              </xsl:attribute>
              <xsl:value-of select='$Var_GroupReceiverID'/>
            </ns10:Property>
              <ns10:Property>
                <xsl:attribute name="Name">
                  <xsl:value-of select='string("GroupDate")'/>
                </xsl:attribute>
                <!--<xsl:value-of select="xp20:current-date()"/> -->
                <xsl:value-of select="concat(substring($Current_date,1.0,4.0),substring($Current_date,6.0,2.0),substring($Current_date,9.0,2.0))"/>
              </ns10:Property>
              <ns10:Property>
                <xsl:attribute name="Name">
                  <xsl:value-of select='string("GroupTime")'/>
                </xsl:attribute>
                <xsl:value-of select="concat(substring($Current_Time,1.0,2.0),substring($Current_Time,4.0,2.0))"/>
              </ns10:Property>
              <ns10:Property>
                <xsl:attribute name="Name">
                  <xsl:value-of select='string("GroupControlNumber")'/>
                </xsl:attribute>
                <xsl:value-of select="$SC_SeqNo"/>
              </ns10:Property>
              <ns10:Property>
                <xsl:attribute name="Name">
                  <xsl:value-of select='string("GroupAgencyCode")'/>
                </xsl:attribute>
                <xsl:value-of select='string("X")'/>
              </ns10:Property>
              <ns10:Property>
                <xsl:attribute name="Name">
                  <xsl:value-of select='string("GroupVersionNumber")'/>
                </xsl:attribute>
                <xsl:value-of select='string("005020")'/>
              </ns10:Property>
              <ns10:Property>
                <xsl:attribute name="Name">
                  <xsl:value-of select='string("GroupChildCount")'/>
                </xsl:attribute>
                <!--  <xsl:value-of select='string("1")'/> -->
                <xsl:value-of select='count(/imp1:CustomChangePO/ChangePO/DataArea/ns3:PurchaseOrder)'/>
              </ns10:Property>
              <ns10:Property>
                <xsl:attribute name="Name">
                  <xsl:value-of select='string("GroupTrailerControlNumber")'/>
                </xsl:attribute>
                <xsl:value-of select="$SC_SeqNo"/>
              </ns10:Property>
              <ns10:Data-Structure>
                <xsl:attribute name="Name">
                  <xsl:value-of select='string("Transaction")'/>
                </xsl:attribute>
                <ns10:Lookup>
                  <xsl:attribute name="Name">
                    <xsl:value-of select='string("TransactionID")'/>
                  </xsl:attribute>
                  <xsl:value-of select='string("850")'/>
                </ns10:Lookup>
                <ns10:Property>
                  <xsl:attribute name="Name">
                    <xsl:value-of select='string("TransactionID")'/>
                  </xsl:attribute>
                  <xsl:value-of select='string("850")'/>
                </ns10:Property>
                <ns10:Property>
                  <xsl:attribute name="Name">
                    <xsl:value-of select='string("TransactionControlNumber")'/>
                  </xsl:attribute>
                  <xsl:value-of select="$SC_SeqNo"/>
                </ns10:Property>
                <ns10:Property>
                  <xsl:attribute name="Name">
                    <xsl:value-of select='string("TransactionImplementationReference")'/>
                  </xsl:attribute>
                  <xsl:value-of select='string("")'/>
                </ns10:Property>
                <ns10:Property>
                  <xsl:attribute name="Name">
                    <xsl:value-of select='string("TransactionChildCount")'/>
                  </xsl:attribute>
                  <!-- <xsl:value-of select='string("35")'/> -->
                  <xsl:value-of select='string("#SegmentCount#")'/>
                </ns10:Property>
                <ns10:Property>
                  <xsl:attribute name="Name">
                    <xsl:value-of select='string("TransactionTrailerControlNumber")'/>
                  </xsl:attribute>
                  <xsl:value-of select="$SC_SeqNo"/>
                </ns10:Property>
              </ns10:Data-Structure>
            </ns10:Data-Structure>
   
      </ns10:Data-Structure>
      </ns10:Internal-Properties>
      <xsl:for-each select="/imp1:CustomChangePO/ChangePO/DataArea/ns3:PurchaseOrder">
     
      <ns10:Segment-ST>      
        <ns10:Element-143>
          <xsl:value-of select="string(850.0)"/>
        </ns10:Element-143>
       <!-- <ns10:Element-329>
          <xsl:value-of select="orcl:lookup-table('SC_MASTER_TRANSACTION','FLOW_ID_1',$flowID,'ST_CONTROL','jdbc:polite4:system/any@142.176.225.81:1531:OraESB')"/>
        </ns10:Element-329>-->
        <ns10:Element-329>
          <!--<xsl:value-of select="string('#ControlNumber#')"/>-->
          <xsl:value-of select="$SC_SeqNo"/>
        </ns10:Element-329>
      </ns10:Segment-ST>
      <ns10:Segment-BEG>
        <!--<ns10:Element-353>
          <xsl:value-of select='string("04")'/>
        </ns10:Element-353>--><!--Commented On 15 DEC--><!-- ADDED AS PER ROBIN'S MAIL ON 23 SEP -->
        <!--Added On 15 DEC-->
        <xsl:choose>
        <xsl:when test="/imp1:CustomChangePO/ChangePO/DataArea/ns3:Change/ns3:ActionCriteria/ns3:ActionExpression/@actionCode !=''">
         <xsl:if test="/imp1:CustomChangePO/ChangePO/DataArea/ns3:Change/ns3:ActionCriteria/ns3:ActionExpression/@actionCode='Cancel'">
        <ns10:Element-353>
          <xsl:value-of select='string("01")'/>
        </ns10:Element-353>
        </xsl:if>
       <xsl:if test="/imp1:CustomChangePO/ChangePO/DataArea/ns3:Change/ns3:ActionCriteria/ns3:ActionExpression/@actionCode ='Change'">
        <ns10:Element-353>
          <xsl:value-of select='string("04")'/>
        </ns10:Element-353>
        </xsl:if>
        <xsl:if test="/imp1:CustomChangePO/ChangePO/DataArea/ns3:Change/ns3:ActionCriteria/ns3:ActionExpression/@actionCode ='Replace'">
        <ns10:Element-353>
          <xsl:value-of select='string("05")'/>
        </ns10:Element-353>
        </xsl:if>
          <xsl:if test="/imp1:CustomChangePO/ChangePO/DataArea/ns3:Change/ns3:ActionCriteria/ns3:ActionExpression/@actionCode ='Delete'">
        <ns10:Element-353>
          <xsl:value-of select='string("03")'/>
        </ns10:Element-353>
        </xsl:if>
        </xsl:when>
        <xsl:otherwise>
        <ns10:Element-353>
          <xsl:value-of select='string("04")'/>
        </ns10:Element-353>
        </xsl:otherwise>
        </xsl:choose>
        <xsl:choose>
          <!-- ADDED AS PER ROBIN'S MAIL ON 23 SEP -->
          <xsl:when test='ns3:PurchaseOrderHeader/ns3:DocumentID/ns3:VariationID = "STANDARD"'>
            <ns10:Element-92>
              <xsl:value-of select='string("SA")'/>
            </ns10:Element-92>
          </xsl:when>
          <xsl:when test='ns3:PurchaseOrderHeader/ns3:DocumentID/ns3:VariationID = "BLANKET"'>
            <ns10:Element-92>
              <xsl:value-of select='string("BK")'/>
            </ns10:Element-92>
          </xsl:when>
        </xsl:choose>
        <!-- ADDED AS PER ROBIN'S MAIL ON 23 SEP -->
        <ns10:Element-324>
          <xsl:value-of select="ns3:PurchaseOrderHeader/ns3:DocumentID/ns3:ID"/>
        </ns10:Element-324>
        <ns10:Element-328>
          <!--<xsl:value-of select="ns3:PurchaseOrderHeader/ns3:ContractReference/ns3:ReleaseNumber"/>-->
          <xsl:value-of select="ns3:PurchaseOrderHeader/ns3:ReleaseNumber"/>
        </ns10:Element-328>
        <ns10:Element-373>           <!-- ADDED AS ON 25 SEP -->        
           <xsl:value-of select="concat(substring(ns3:PurchaseOrderHeader/ns3:DocumentDateTime,1.0,4.0),substring(ns3:PurchaseOrderHeader/ns3:DocumentDateTime,6.0,2.0),substring(ns3:PurchaseOrderHeader/ns3:DocumentDateTime,9.0,2.0))"/>
        </ns10:Element-373>
        <ns10:Element-367>
          <xsl:value-of select="ns3:PurchaseOrderHeader/ns3:ContractReference/ns3:DocumentID/ns3:ID"/>
        </ns10:Element-367>  
         <xsl:if test='(ns3:PurchaseOrderHeader/ns3:UserArea/ns3:ActionExpression/@actionCode = "Y") or (ns3:PurchaseOrderHeader/ns3:UserArea/ns3:ActionExpression/@actionCode = "AcknowledgementRequired")'>
            <ns10:Element-587>
              <xsl:value-of select='string("AC")'/>
            </ns10:Element-587>
          </xsl:if>
          <xsl:if test='(ns3:PurchaseOrderHeader/ns3:UserArea/ns3:ActionExpression/@actionCode = "N") or (ns3:PurchaseOrderHeader/ns3:UserArea/ns3:ActionExpression/@actionCode = "DoNotAcknowledge")'>
            <ns10:Element-587>
              <xsl:value-of select='string("NA")'/>
            </ns10:Element-587>
          </xsl:if>
        <ns10:Element-786>
          <xsl:value-of select='string("03")'/>
        </ns10:Element-786>
        <!-- ADDED AS PER ROBIN'S MAIL ON 23 SEP -->
      </ns10:Segment-BEG>
      <ns10:Segment-CUR>
        <ns10:Element-98>
          <xsl:value-of select='string("BY")'/>
        </ns10:Element-98>
        <ns10:Element-100>
          <xsl:value-of select="ns3:PurchaseOrderHeader/ns3:ExtendedAmount/@currencyID"/>
        </ns10:Element-100> 
        <!-- ADDED AS ON 23 OCT "RateNumeric CONDITION" -->   
        <xsl:if test='ns3:PurchaseOrderHeader/ns3:UserArea/ns3:CurrencyExchangeRate/ns3:RateNumeric != ""'>  
        <ns10:Element-280>
          <xsl:value-of select="ns3:PurchaseOrderHeader/ns3:UserArea/ns3:CurrencyExchangeRate/ns3:RateNumeric"/>
        </ns10:Element-280> 
        </xsl:if>
        <xsl:if test='ns3:PurchaseOrderHeader/ns3:UserArea/ns3:CurrencyExchangeRate/ns3:SetDateTime != ""'> <!-- ADDED AS ON 23 OCT -->   
        <ns10:Element-374>
          <xsl:value-of select='string("AAY")'/>
        </ns10:Element-374>
        <ns10:Element-373_1>
          <xsl:value-of select="concat(substring(ns3:PurchaseOrderHeader/ns3:UserArea/ns3:CurrencyExchangeRate/ns3:SetDateTime,1.0,4.0),substring(ns3:PurchaseOrderHeader/ns3:UserArea/ns3:CurrencyExchangeRate/ns3:SetDateTime,6.0,2.0),substring(ns3:PurchaseOrderHeader/ns3:UserArea/ns3:CurrencyExchangeRate/ns3:SetDateTime,9.0,2.0))"/>
        </ns10:Element-373_1>
        <ns10:Element-337>
          <xsl:value-of select="concat(substring(ns3:PurchaseOrderHeader/ns3:UserArea/ns3:CurrencyExchangeRate/ns3:SetDateTime,12.0,2.0),substring(ns3:PurchaseOrderHeader/ns3:UserArea/ns3:CurrencyExchangeRate/ns3:SetDateTime,15.0,2.0),substring(ns3:PurchaseOrderHeader/ns3:UserArea/ns3:CurrencyExchangeRate/ns3:SetDateTime,18.0,2.0))"/>
        </ns10:Element-337>
        </xsl:if><!-- ADDED AS ON 25 SEP -->   
      </ns10:Segment-CUR>
      
      <xsl:for-each select="/imp1:CustomChangePO/ChangePO/ns3:ApplicationArea/ns3:Sender">
        <ns10:Segment-REF>
          <ns10:Element-128>
            <xsl:value-of select='string("S3")'/>
          </ns10:Element-128>
          <ns10:Element-127>
            <xsl:value-of select='string("EMR850V5.0")'/> <!-- ADDED AS ON 25 SEP -->
          </ns10:Element-127>
        </ns10:Segment-REF>
      </xsl:for-each> 
      
      <!-- ADDED AS ON 23 OCT " IF COMDITION ,FOR-EACH & REF" -->
     
   <!--  <xsl:for-each select="ns3:PurchaseOrderHeader"> -->
     <!--<xsl:if test="/imp1:CustomChangePO/ChangePO/ns3:ApplicationArea/ns3:Sender/ns3:LogicalID ='LIEBERTNA'">-->
        <xsl:if test='ns3:PurchaseOrderHeader/ns3:DocumentID/ns3:RevisionID != ""'> 
          <ns10:Segment-REF>
            <ns10:Element-128>
              <xsl:value-of select='string("PP")'/>
            </ns10:Element-128>
            <ns10:Element-352>
              <xsl:value-of select="ns3:PurchaseOrderHeader/ns3:DocumentID/ns3:RevisionID"/>
            </ns10:Element-352>
          </ns10:Segment-REF>
       </xsl:if> 
      <!--</xsl:if> -->
  <!--  </xsl:for-each> -->
    
      <xsl:for-each select="/imp1:CustomChangePO/ChangePO/ns3:ApplicationArea/ns3:Sender">
      <!--<xsl:if test ='ns3:ReferenceID != ""'> --><!-- Removed as on 3 Nov -->
       <xsl:if test='ns3:AuthorizationID !=""'><!-- Changed as on 3 Nov -->
        <ns10:Segment-REF>
          <ns10:Element-128>
            <xsl:value-of select='string("06")'/>
          </ns10:Element-128>
          <ns10:Element-352>
	    <!-- <xsl:value-of select="ns3:ReferenceID"/> --><!-- Removed as on 3 Nov -->
            <xsl:value-of select="ns3:AuthorizationID"/><!-- Changed as on 3 Nov -->
          </ns10:Element-352>
        </ns10:Segment-REF>
        </xsl:if>
      </xsl:for-each>
      
      <xsl:if test='ns3:PurchaseOrderHeader/ns3:Description !=""'> <!-- ADDED AS ON 25 SEP -->   
      <xsl:for-each select="ns3:PurchaseOrderHeader"> 
        <ns10:Segment-REF>
          <ns10:Element-128>
            <xsl:value-of select='string("K6")'/>  <!-- CHANGED ON 24 SEP -->
          </ns10:Element-128>
          <ns10:Element-352>
            <xsl:value-of select="ns3:Description"/> <!-- CHANGED ON 24 SEP -->
          </ns10:Element-352>
        </ns10:Segment-REF>
      </xsl:for-each>
       </xsl:if>      <!-- ADDED AS ON 25 SEP -->
       
       <!-- ADDED AS ON 1 DEC THE FOLLOWING REF SEGMENT-->
        <!--<xsl:for-each select="ns3:PurchaseOrderLine/ns3:PurchaseOrderSchedule">-->
      <!-- <xsl:if test='((ns3:Note[1] !="") and (ns3:Note/@author = "Emerson Location Identifier"))'>
          <ns10:Segment-REF>
            <ns10:Element-128>
              <xsl:value-of select='string("4C")'/>
            </ns10:Element-128>
            <ns10:Element-127>
              <xsl:value-of select="ns3:Note"/>
            </ns10:Element-127>
          </ns10:Segment-REF>
    </xsl:if>
       <xsl:if test='((ns3:Note[2] !="") and (ns3:Note/@author = "Kanban Card Number"))'>
          <ns10:Segment-REF>
            <ns10:Element-128>
              <xsl:value-of select='string("KE")'/>
            </ns10:Element-128>
            <ns10:Element-127>
              <xsl:value-of select="ns3:Note"/>
            </ns10:Element-127>
          </ns10:Segment-REF>
    </xsl:if>-->
 <!--</xsl:for-each>-->
    
       <!-- ADDED AS ON 1 DEC THE FOLLLOWING IF CONDITION -->
      <xsl:if test="(ns3:PurchaseOrderHeader/ns3:TransportationTerm/ns3:FreightTermCode != '') or (ns3:PurchaseOrderHeader/ns3:TransportationTerm/ns3:PlaceOfOwnershipTransferLocation/ns3:Name !='') ">
      <ns10:Segment-FOB>
        <!-- 23 Jun 2009 - Fix for Issue 45a -->
        <xsl:choose>
            <xsl:when test="(ns3:PurchaseOrderHeader/ns3:TransportationTerm/ns3:FreightTermCode = 'UCC FOB ORIGIN PPD') or (ns3:PurchaseOrderHeader/ns3:TransportationTerm/ns3:FreightTermCode = 'UCC FOB DEST PPD')">
                <ns10:Element-146>       
                  <xsl:value-of select='string("PP")'/>
                </ns10:Element-146>
            </xsl:when>
            <xsl:when test="(ns3:PurchaseOrderHeader/ns3:TransportationTerm/ns3:FreightTermCode = 'UCC FOB ORIGIN COL') or (ns3:PurchaseOrderHeader/ns3:TransportationTerm/ns3:FreightTermCode = 'UCC FOB DEST COL')">
                <ns10:Element-146>       
                  <xsl:value-of select='string("CC")'/>
                </ns10:Element-146>
            </xsl:when>
            <xsl:otherwise>
                <ns10:Element-146>       
                  <xsl:value-of select='string("DF")'/>
                </ns10:Element-146>
            </xsl:otherwise>
          </xsl:choose>
          <!-- 23 Jun 2009 - Fix for Issue 45a -->
          <!-- 05 Oct 2009 - Updated to populate FOB03 from IncotermsCode instead of FreightTerm, as per new mapping -->
        <xsl:if test="ns3:PurchaseOrderHeader/ns3:TransportationTerm/ns3:IncotermsCode != ''">
         <ns10:Element-309>
          <xsl:value-of select='string("ZZ")'/>
        </ns10:Element-309>
        <ns10:Element-352>
            <xsl:value-of select="ns3:PurchaseOrderHeader/ns3:TransportationTerm/ns3:IncotermsCode"/>
          <!--<xsl:value-of select="ns3:PurchaseOrderHeader/ns3:TransportationTerm/ns3:FreightTermCode"/>-->
        </ns10:Element-352>
        </xsl:if>
        <!-- 05 Oct 2009 - Updated to populate FOB03 from IncotermsCode instead of FreightTerm, as per new mapping -->
        <!--ADDED AS ON 23 OCT "LOGICALID" CONDITION -->
        <xsl:if test="/imp1:CustomChangePO/ChangePO/ns3:ApplicationArea/ns3:Sender/ns3:LogicalID ='LIEBERTNA'">
        <xsl:if test="ns3:PurchaseOrderHeader/ns3:TransportationTerm/ns3:PlaceOfOwnershipTransferLocation/ns3:Name !=''">
        <ns10:Element-309_5>
          <xsl:value-of select='string("ZZ")'/>
        </ns10:Element-309_5>
        <ns10:Element-352_1>
          <xsl:value-of select="ns3:PurchaseOrderHeader/ns3:TransportationTerm/ns3:PlaceOfOwnershipTransferLocation/ns3:Name"/>
        </ns10:Element-352_1>
        </xsl:if>
        </xsl:if>
      </ns10:Segment-FOB> 
      </xsl:if>
        <!-- ADDED If as on April-24- 2009 as it was erroring out in B2B at the segment count-->
         <xsl:if test="ns3:PurchaseOrderHeader/ns3:PaymentTerm/ns3:Term/ns3:ID !=''">
      <ns10:Segment-ITD>
        <ns10:Element-352_3>
          <xsl:value-of select="ns3:PurchaseOrderHeader/ns3:PaymentTerm/ns3:Term/ns3:ID"/>
        </ns10:Element-352_3>
      </ns10:Segment-ITD>
      </xsl:if>
             <!-- ADDED If as on April-24- 2009-->
        <xsl:if test="ns3:PurchaseOrderHeader/ns3:Note != ''">
        <ns10:Loop-N9><!-- ADDED AS ON 8 OCT "loop-n9" -->
        <xsl:if test="ns3:PurchaseOrderHeader/ns3:Note != ''">
        <ns10:Segment-N9>
          <ns10:Element-128_4>
            <xsl:value-of select='string("L1")'/>
          </ns10:Element-128_4>
          <ns10:Element-127_1>
            <xsl:value-of select='string("PO Header Instructions to Supplier")'/>
          </ns10:Element-127_1>
        </ns10:Segment-N9>   
        </xsl:if>
        <xsl:if test="ns3:PurchaseOrderHeader/ns3:Note != ''">
        <ns10:Segment-MTX_1>
          <ns10:Element-363_1>
            <xsl:value-of select='string("OTH")'/>
          </ns10:Element-363_1>
          <xsl:if test="ns3:PurchaseOrderHeader/ns3:Note[1] != ''">
           <ns10:Element-1551_2>
            <xsl:value-of select="normalize-space(ns3:PurchaseOrderHeader/ns3:Note[1])"/>
          </ns10:Element-1551_2>
          </xsl:if>
          <xsl:if test="ns3:PurchaseOrderHeader/ns3:Note[1] = ''">
           <ns10:Element-1551_2>
            <xsl:value-of select="string('NULL')"/>
          </ns10:Element-1551_2>
          </xsl:if>
        
          
         <xsl:if test="ns3:PurchaseOrderHeader/ns3:Note[2] != ''">
          <ns10:Element-1551>
            <xsl:value-of select="normalize-space(ns3:PurchaseOrderHeader/ns3:Note[2])"/>
          </ns10:Element-1551> 
          </xsl:if>
          <xsl:if test="ns3:PurchaseOrderHeader/ns3:Note[2] = ''">
          <ns10:Element-1551>
            <xsl:value-of select="string('NULL')"/>
          </ns10:Element-1551> 
          </xsl:if> 
        </ns10:Segment-MTX_1> 
         </xsl:if> 
      </ns10:Loop-N9>
      </xsl:if><!-- ADDED AS ON 8 OCT "loop-n9"-->
      <!-- SUPPLIER -->
      <xsl:for-each select="ns3:PurchaseOrderHeader/ns3:SupplierParty">
        <ns10:Loop-N1>
          <ns10:Segment-N1>
            <ns10:Element-98_3>
              <xsl:value-of select='string("VN")'/>
            </ns10:Element-98_3>
            <ns10:Element-93_1>
              <xsl:value-of select="substring(ns3:Name[1],1.0,60.0)"/>
            </ns10:Element-93_1>
            <ns10:Element-66_1>
              <xsl:value-of select='string("93")'/>
            </ns10:Element-66_1>
            <ns10:Element-67>
              <xsl:value-of select="ns3:PartyIDs/ns3:ID"/>
            </ns10:Element-67>
          </ns10:Segment-N1>
          <!--  Updated as per new mapping (Robin's email dated 21st Oct 2009) to set multiple "Name" fields from input --> 
          <!--<xsl:variable name="LENGTH_VN">  
             <xsl:value-of select="string-length(ns3:Name)"/>
          </xsl:variable> 
         <xsl:if test="$LENGTH_VN > 60.0">-->   <!-- ADDED AS ON 8 OCT-->
         <xsl:if test="ns3:Name[2] != '' or ns3:Name[3] != ''">
          <ns10:Segment-N2>
            <xsl:if test="ns3:Name[2] != ''">
                <ns10:Element-93_1>
                  <xsl:value-of select="substring(ns3:Name[2],1.0,60.0)"/>
                </ns10:Element-93_1>
            </xsl:if>
            <xsl:if test="ns3:Name[3] != ''">          
                <ns10:Element-93>
                  <xsl:value-of select="substring(ns3:Name[3],1.0,60.0)"/>
                </ns10:Element-93>
          </xsl:if>
          </ns10:Segment-N2>          
          </xsl:if>
          <xsl:if test="ns3:Name[4] != '' or ns3:Name[5] != ''">
          <ns10:Segment-N2>
            <xsl:if test="ns3:Name[4] != ''">
                <ns10:Element-93_1>
                  <xsl:value-of select="substring(ns3:Name[4],1.0,60.0)"/>
                </ns10:Element-93_1>
            </xsl:if>
            <xsl:if test="ns3:Name[5] != ''">
                <ns10:Element-93>
                  <xsl:value-of select="substring(ns3:Name[5],1.0,60.0)"/>
                </ns10:Element-93>
            </xsl:if>
          </ns10:Segment-N2>
          </xsl:if>          
          <!--  Updated as per new mapping (Robin's email dated 21st Oct 2009) to set multiple "Name" fields from input --> 
          <!-- Added the 55 character check on April-24- 2009-->
          <xsl:if test='(ns3:Location/ns3:Address/ns3:LineOne!="") or (ns3:Location/ns3:Address/ns3:LineTwo != "")'>
            <ns10:Segment-N3>
            <xsl:if test='(string-length(ns3:Location/ns3:Address/ns3:LineOne) &lt;= 55)'>
            <ns10:Element-166>
              <xsl:value-of select="ns3:Location/ns3:Address/ns3:LineOne"/> 
            </ns10:Element-166>
            </xsl:if>
              <xsl:if test='(string-length(ns3:Location/ns3:Address/ns3:LineOne) &gt; 55)'>
            <ns10:Element-166>
              <xsl:value-of select="concat(substring(ns3:Location/ns3:Address/ns3:LineOne,1,54),'+')"/>
              <!--<xsl:value-of select="ns3:Location/ns3:Address/ns3:LineOne"/> -->
            </ns10:Element-166>
            </xsl:if>
             <xsl:if test='(string-length(ns3:Location/ns3:Address/ns3:LineTwo) &lt;= 55)'>
            <ns10:Element-166_1>
              <xsl:value-of select="ns3:Location/ns3:Address/ns3:LineTwo"/>
            </ns10:Element-166_1>
               </xsl:if>
                <xsl:if test='(string-length(ns3:Location/ns3:Address/ns3:LineTwo)  &gt; 55)'>
            <ns10:Element-166_1>
              <xsl:value-of select="concat(substring(ns3:Location/ns3:Address/ns3:LineTwo,1,54),'+')"/>
            </ns10:Element-166_1>
               </xsl:if>
          </ns10:Segment-N3> 
       
          </xsl:if>
          <!--ADDED AS ON 16 OCT -->
          <!-- Added the 55 character check on April-24- 2009-->
            <xsl:if test='(ns3:Location/ns3:Address/ns3:LineThree!="") or (ns3:Location/ns3:Address/ns3:LineFour != "")'>
            <ns10:Segment-N3>
              <xsl:if test='(string-length(ns3:Location/ns3:Address/ns3:LineThree) &lt;= 55)'>
            <ns10:Element-166>
              <xsl:value-of select="ns3:Location/ns3:Address/ns3:LineThree"/>
            </ns10:Element-166>
            </xsl:if>
             <xsl:if test='(string-length(ns3:Location/ns3:Address/ns3:LineThree) &gt; 55)'>
            <ns10:Element-166>
              <xsl:value-of select="concat(substring(ns3:Location/ns3:Address/ns3:LineThree,1,54),'+')"/>
             </ns10:Element-166>
            </xsl:if>
            <xsl:if test='(string-length(ns3:Location/ns3:Address/ns3:LineFour) &lt;= 55)'>
            <ns10:Element-166_1>
              <xsl:value-of select="ns3:Location/ns3:Address/ns3:LineFour"/>
            </ns10:Element-166_1>
            </xsl:if>
             <xsl:if test='(string-length(ns3:Location/ns3:Address/ns3:LineFour) &gt; 55)'>
            <ns10:Element-166_1>
              <xsl:value-of select="concat(substring(ns3:Location/ns3:Address/ns3:LineFour,1,54),'+')"/>
             </ns10:Element-166_1>
            </xsl:if>
         
            
          </ns10:Segment-N3> 
          </xsl:if>
            <xsl:if test="(ns3:Location/ns3:Address/ns3:CityName !='') or (ns3:Location/ns3:Address/ns3:PostalCode !='') or (ns3:Location/ns3:Address/ns3:CountryCode !='') or (ns3:Location/ns3:Address/ns3:CountrySubDivisionCode !='') or (ns3:Location/ns3:ID !='')">
          <ns10:Segment-N4>
          <xsl:if test="(ns3:Location/ns3:Address/ns3:CityName !='')">
            <ns10:Element-19>
              <xsl:value-of select="ns3:Location/ns3:Address/ns3:CityName"/>
            </ns10:Element-19>
            </xsl:if>
           <!-- <xsl:if test='((ns3:Location/ns3:Address/ns3:CountryCode = "US") or (ns3:Location/ns3:Address/ns3:CountryCode = "CA"))'>
              <ns10:Element-156>
                <xsl:value-of select="ns3:Location/ns3:Address/ns3:CountrySubDivisionCode"/>
              </ns10:Element-156>
            </xsl:if>--><!--Removed on 18 MAR-->
            <xsl:if test="(ns3:Location/ns3:Address/ns3:PostalCode !='')">
            <ns10:Element-116>
              <xsl:value-of select="ns3:Location/ns3:Address/ns3:PostalCode"/>
            </ns10:Element-116>
            </xsl:if>
            <xsl:if test="(ns3:Location/ns3:Address/ns3:CountryCode !='')">
            <ns10:Element-26_1>
              <xsl:value-of select="ns3:Location/ns3:Address/ns3:CountryCode"/>
            </ns10:Element-26_1>
            </xsl:if>
             <xsl:if test ="ns3:Location/ns3:ID !=''"> <!-- Added as on 3 Nov the "If" condition -->
            <ns10:Element-309_6>
              <xsl:value-of select="string(93.0)"/>
            </ns10:Element-309_6>
            <ns10:Element-310>
              <xsl:value-of select="ns3:Location/ns3:ID"/>
            </ns10:Element-310>
            </xsl:if>
                        
 <!-- Added choose when condition on April-24 2009 to convert contrydivision name  to  code-->
            <!--<xsl:if test='((ns3:Location/ns3:Address/ns3:CountryCode != "US") and (ns3:Location/ns3:Address/ns3:CountryCode !="CA"))'>--><!--Removed on 18 MAR-->
           <!-- <xsl:if test="(ns3:Location/ns3:Address/ns3:CountrySubDivisionCode !='')"> -->
               <xsl:choose>
              <xsl:when test="(string-length(ns3:Location/ns3:Address/ns3:CountrySubDivisionCode) &lt;= 3)">
              <ns10:Element-1715>
              <!--Changed on April-22-->
               <xsl:value-of select='orcl:lookup-dvm("Country Subdivisions","Target",ns3:Location/ns3:Address/ns3:CountrySubDivisionCode,"EDICode",ns3:Location/ns3:Address/ns3:CountrySubDivisionCode)'/>
              <!--  <xsl:value-of select="ns3:Location/ns3:Address/ns3:CountrySubDivisionCode"/> -->
              </ns10:Element-1715>
              </xsl:when>
              <xsl:otherwise>
              <ns10:Element-1715>
                <xsl:value-of select='orcl:lookup-dvm("Country Subdivisions","Target",ns3:Location/ns3:Address/ns3:CountrySubDivisionCode,"EDICode","ZZZ")'/>
              </ns10:Element-1715>
           </xsl:otherwise>
          </xsl:choose>
         <!--     </xsl:if> -->
            <!--</xsl:if>-->
          </ns10:Segment-N4> 
          </xsl:if>
          <!--ADDED AS ON 23 OCT "NAME CONDITION" -->
          <xsl:if test='((ns3:CustomerServiceContact/ns3:Name != "") or (ns3:CustomerServiceContact/ns3:Communication[3]/ns3:DialNumber != "")or(ns3:CustomerServiceContact/ns3:Communication[2]/ns3:DialNumber != "")or(ns3:CustomerServiceContact/ns3:Communication[1]/ns3:URI != ""))'>
          <!--<xsl:if test='ns3:CustomerServiceContact/ns3:Name != ""'>-->
           <ns10:Segment-PER_1>
             <!-- <xsl:if test='ns3:CustomerServiceContact/ns3:Name != ""'>-->
                <ns10:Element-366_1>
                  <xsl:value-of select='string("SU")'/>
                </ns10:Element-366_1>
              <xsl:if test='ns3:CustomerServiceContact/ns3:Name != ""'>
              <ns10:Element-93>
                <xsl:value-of select="ns3:CustomerServiceContact/ns3:Name"/>
              </ns10:Element-93>
              </xsl:if>
              <xsl:if test='ns3:CustomerServiceContact/ns3:Communication[3]/ns3:DialNumber != ""'>
                <ns10:Element-365_3>
                  <xsl:value-of select='string("TE")'/>
                </ns10:Element-365_3>
              <ns10:Element-364>
                <xsl:value-of select="ns3:CustomerServiceContact/ns3:Communication[3]/ns3:DialNumber"/>
              </ns10:Element-364>
               </xsl:if>
              <xsl:if test='ns3:CustomerServiceContact/ns3:Communication[2]/ns3:DialNumber != ""'>
                <ns10:Element-365_4>
                  <xsl:value-of select='string("FX")'/>
                </ns10:Element-365_4>
              <ns10:Element-364_1>
                <xsl:value-of select="ns3:CustomerServiceContact/ns3:Communication[2]/ns3:DialNumber"/>
              </ns10:Element-364_1>
              </xsl:if>
              <xsl:if test='ns3:CustomerServiceContact/ns3:Communication[1]/ns3:URI != ""'>
              <ns10:Element-365_5>
                <xsl:value-of select='string("EM")'/>
              </ns10:Element-365_5>
              <ns10:Element-364_2>
                <xsl:value-of select="ns3:CustomerServiceContact/ns3:Communication[1]/ns3:URI"/>
              </ns10:Element-364_2>
              </xsl:if>
            </ns10:Segment-PER_1>  
          </xsl:if>
        </ns10:Loop-N1>
      </xsl:for-each>
      <!-- SOLDTO -->
      <xsl:for-each select="ns3:PurchaseOrderHeader/ns3:BuyerParty">
        <xsl:if test='concat(@category,"BuyerParty")'>
          <ns10:Loop-N1>
          <xsl:if test="ns3:Name[1] != ''">
            <ns10:Segment-N1>
              <ns10:Element-98_3>
                <xsl:value-of select='string("SO")'/>
              </ns10:Element-98_3>
              <ns10:Element-93_1>
                <xsl:value-of select="substring(ns3:Name[1],1.0,60.0)"/>
              </ns10:Element-93_1>
            </ns10:Segment-N1>
          </xsl:if>
          <!--  Updated as per new mapping (Robin's email dated 21st Oct 2009) to set multiple "Name" fields from input --> 
          <!--<xsl:variable name="LENGTH_SO">  
                 <xsl:value-of select="string-length(ns3:Name)"/>
            </xsl:variable> 
            <xsl:if test="$LENGTH_SO > 60.0">-->   <!-- ADDED AS ON 8 OCT-->
         <xsl:if test="ns3:Name[2] != '' or ns3:Name[3] != ''">
          <ns10:Segment-N2>
            <xsl:if test="ns3:Name[2] != ''">
                <ns10:Element-93_1>
                  <xsl:value-of select="substring(ns3:Name[2],1.0,60.0)"/>
                </ns10:Element-93_1>
            </xsl:if>
            <xsl:if test="ns3:Name[3] != ''">          
                <ns10:Element-93>
                  <xsl:value-of select="substring(ns3:Name[3],1.0,60.0)"/>
                </ns10:Element-93>
          </xsl:if>
          </ns10:Segment-N2>          
          </xsl:if>
          <xsl:if test="ns3:Name[4] != '' or ns3:Name[5] != ''">
          <ns10:Segment-N2>
            <xsl:if test="ns3:Name[4] != ''">
                <ns10:Element-93_1>
                  <xsl:value-of select="substring(ns3:Name[4],1.0,60.0)"/>
                </ns10:Element-93_1>
            </xsl:if>
            <xsl:if test="ns3:Name[5] != ''">
                <ns10:Element-93>
                  <xsl:value-of select="substring(ns3:Name[5],1.0,60.0)"/>
                </ns10:Element-93>
            </xsl:if>
          </ns10:Segment-N2>
          </xsl:if>          
          <!--  Updated as per new mapping (Robin's email dated 21st Oct 2009) to set multiple "Name" fields from input --> 
            <!-- Added the 55 character check on April-24- 2009-->
             <xsl:if test='(ns3:Location/ns3:Address/ns3:LineOne!="") or (ns3:Location/ns3:Address/ns3:LineTwo != "")'>
            <ns10:Segment-N3>
            <xsl:if test='(string-length(ns3:Location/ns3:Address/ns3:LineOne) &lt;= 55)'>
            <ns10:Element-166>
              <xsl:value-of select="ns3:Location/ns3:Address/ns3:LineOne"/> 
            </ns10:Element-166>
            </xsl:if>
              <xsl:if test='(string-length(ns3:Location/ns3:Address/ns3:LineOne) &gt; 55)'>
            <ns10:Element-166>
              <xsl:value-of select="concat(substring(ns3:Location/ns3:Address/ns3:LineOne,1,54),'+')"/>
              <!--<xsl:value-of select="ns3:Location/ns3:Address/ns3:LineOne"/> -->
            </ns10:Element-166>
            </xsl:if>
             <xsl:if test='(string-length(ns3:Location/ns3:Address/ns3:LineTwo) &lt;= 55)'>
            <ns10:Element-166_1>
              <xsl:value-of select="ns3:Location/ns3:Address/ns3:LineTwo"/>
            </ns10:Element-166_1>
               </xsl:if>
                <xsl:if test='(string-length(ns3:Location/ns3:Address/ns3:LineTwo)  &gt; 55)'>
            <ns10:Element-166_1>
              <xsl:value-of select="concat(substring(ns3:Location/ns3:Address/ns3:LineTwo,1,54),'+')"/>
            </ns10:Element-166_1>
               </xsl:if>
          </ns10:Segment-N3> 
       
          </xsl:if>
            <!--ADDED AS ON 16 OCT -->
            <!-- Added the 55 character check on April-24- 2009-->
            <xsl:if test='(ns3:Location/ns3:Address/ns3:LineThree!="") or (ns3:Location/ns3:Address/ns3:LineFour != "")'>
            <ns10:Segment-N3>
              <xsl:if test='(string-length(ns3:Location/ns3:Address/ns3:LineThree) &lt;= 55)'>
            <ns10:Element-166>
              <xsl:value-of select="ns3:Location/ns3:Address/ns3:LineThree"/>
            </ns10:Element-166>
            </xsl:if>
             <xsl:if test='(string-length(ns3:Location/ns3:Address/ns3:LineThree) &gt; 55)'>
            <ns10:Element-166>
              <xsl:value-of select="concat(substring(ns3:Location/ns3:Address/ns3:LineThree,1,54),'+')"/>
             </ns10:Element-166>
            </xsl:if>
            <xsl:if test='(string-length(ns3:Location/ns3:Address/ns3:LineFour) &lt;= 55)'>
            <ns10:Element-166_1>
              <xsl:value-of select="ns3:Location/ns3:Address/ns3:LineFour"/>
            </ns10:Element-166_1>
            </xsl:if>
             <xsl:if test='(string-length(ns3:Location/ns3:Address/ns3:LineFour) &gt; 55)'>
            <ns10:Element-166>
              <xsl:value-of select="concat(substring(ns3:Location/ns3:Address/ns3:LineFour,1,54),'+')"/>
             </ns10:Element-166>
            </xsl:if>
         
            
          </ns10:Segment-N3> 
          </xsl:if>
              <xsl:if test="(ns3:Location/ns3:Address/ns3:CityName !='') or (ns3:Location/ns3:Address/ns3:PostalCode !='') or (ns3:Location/ns3:Address/ns3:CountryCode !='') or (ns3:Location/ns3:Address/ns3:CountrySubDivisionCode !='') or (ns3:Location/ns3:ID !='')">
            <ns10:Segment-N4>
            <xsl:if test="(ns3:Location/ns3:Address/ns3:CityName !='')">
              <ns10:Element-19>
                <xsl:value-of select="ns3:Location/ns3:Address/ns3:CityName"/>
              </ns10:Element-19>
              </xsl:if>
              <!--<xsl:if test='((ns3:Location/ns3:Address/ns3:CountryCode ="US") or (ns3:Location/ns3:Address/ns3:CountryCode="CA"))'>
                <ns10:Element-156>
                  <xsl:value-of select="ns3:Location/ns3:Address/ns3:CountrySubDivisionCode"/>
                </ns10:Element-156>
              </xsl:if>--><!--Removed on 18 MAR-->
              <xsl:if test="(ns3:Location/ns3:Address/ns3:PostalCode !='')">
              <ns10:Element-116>
                <xsl:value-of select="ns3:Location/ns3:Address/ns3:PostalCode"/>
              </ns10:Element-116>
              </xsl:if>
              <xsl:if test="(ns3:Location/ns3:Address/ns3:CountryCode !='')">
              <ns10:Element-26_1>
                <xsl:value-of select="ns3:Location/ns3:Address/ns3:CountryCode"/>
              </ns10:Element-26_1>
              </xsl:if>
              <xsl:if test ="ns3:Location/ns3:ID !=''"> <!-- Added as on 3 Nov the "If" condition -->
              <ns10:Element-309_6>
                <xsl:value-of select="string(93.0)"/>
              </ns10:Element-309_6>
              <ns10:Element-310>
                <xsl:value-of select="ns3:Location/ns3:ID"/>
              </ns10:Element-310>
              </xsl:if>
               <!-- Added choose when condition on April-24 2009 to convert countrydivision name  to  3 digit code-->
          <!--    <xsl:if test='((ns3:Location/ns3:Address/ns3:CountryCode !="US") and (ns3:Location/ns3:Address/ns3:CountryCode !="CA"))'> -->
            <!--  <xsl:if test="(ns3:Location/ns3:Address/ns3:CountrySubDivisionCode !='')"> --> <!--Removed on 18 MAR-->
                <xsl:choose>
              <xsl:when test="(string-length(ns3:Location/ns3:Address/ns3:CountrySubDivisionCode) &lt;= 3)">
              <ns10:Element-1715>
              <!--Changed on April-22-->
               <xsl:value-of select='orcl:lookup-dvm("Country Subdivisions","Target",ns3:Location/ns3:Address/ns3:CountrySubDivisionCode,"EDICode",ns3:Location/ns3:Address/ns3:CountrySubDivisionCode)'/>
              <!--  <xsl:value-of select="ns3:Location/ns3:Address/ns3:CountrySubDivisionCode"/> -->
              </ns10:Element-1715>
              </xsl:when>
             <xsl:otherwise>
              <ns10:Element-1715>
                <xsl:value-of select='orcl:lookup-dvm("Country Subdivisions","Target",ns3:Location/ns3:Address/ns3:CountrySubDivisionCode,"EDICode","ZZZ")'/> 
              
              </ns10:Element-1715>
       </xsl:otherwise>
          </xsl:choose>
            <!-- </xsl:if> -->
              <!--</xsl:if>-->
            </ns10:Segment-N4>
            </xsl:if>
          </ns10:Loop-N1>
        </xsl:if>
      </xsl:for-each>
      
     <!-- BILLTO --> 
      <xsl:for-each select="ns3:PurchaseOrderHeader/ns3:BillToParty">
        <ns10:Loop-N1>
        <xsl:if test="ns3:Name[1] != ''">
          <ns10:Segment-N1>
            <ns10:Element-98_3>
              <xsl:value-of select='string("BT")'/>
            </ns10:Element-98_3>
            <ns10:Element-93_1>
              <xsl:value-of select="substring(ns3:Name[1],1.0,60.0)"/>
            </ns10:Element-93_1>
          </ns10:Segment-N1>
          </xsl:if>
          <!--  Updated as per new mapping (Robin's email dated 21st Oct 2009) to set multiple "Name" fields from input --> 
          <!--<xsl:variable name="LENGTH_BT">  
                 <xsl:value-of select="string-length(ns3:Name)"/>
            </xsl:variable> 
            <xsl:if test="$LENGTH_BT > 60.0">-->   <!-- ADDED AS ON 8 OCT-->
         <xsl:if test="ns3:Name[2] != '' or ns3:Name[3] != ''">
          <ns10:Segment-N2>
            <xsl:if test="ns3:Name[2] != ''">
                <ns10:Element-93_1>
                  <xsl:value-of select="substring(ns3:Name[2],1.0,60.0)"/>
                </ns10:Element-93_1>
            </xsl:if>
            <xsl:if test="ns3:Name[3] != ''">          
                <ns10:Element-93>
                  <xsl:value-of select="substring(ns3:Name[3],1.0,60.0)"/>
                </ns10:Element-93>
          </xsl:if>
          </ns10:Segment-N2>          
          </xsl:if>
          <xsl:if test="ns3:Name[4] != '' or ns3:Name[5] != ''">
          <ns10:Segment-N2>
            <xsl:if test="ns3:Name[4] != ''">
                <ns10:Element-93_1>
                  <xsl:value-of select="substring(ns3:Name[4],1.0,60.0)"/>
                </ns10:Element-93_1>
            </xsl:if>
            <xsl:if test="ns3:Name[5] != ''">
                <ns10:Element-93>
                  <xsl:value-of select="substring(ns3:Name[5],1.0,60.0)"/>
                </ns10:Element-93>
            </xsl:if>
          </ns10:Segment-N2>
          </xsl:if>          
          <!--  Updated as per new mapping (Robin's email dated 21st Oct 2009) to set multiple "Name" fields from input --> 
          <!-- Added the 55 character check on April-24- 2009-->
           <xsl:if test='(ns3:Location/ns3:Address/ns3:LineOne!="") or (ns3:Location/ns3:Address/ns3:LineTwo != "")'>
            <ns10:Segment-N3>
            <xsl:if test='(string-length(ns3:Location/ns3:Address/ns3:LineOne) &lt;= 55)'>
            <ns10:Element-166>
              <xsl:value-of select="ns3:Location/ns3:Address/ns3:LineOne"/> 
            </ns10:Element-166>
            </xsl:if>
              <xsl:if test='(string-length(ns3:Location/ns3:Address/ns3:LineOne) &gt; 55)'>
            <ns10:Element-166>
              <xsl:value-of select="concat(substring(ns3:Location/ns3:Address/ns3:LineOne,1,54),'+')"/>
              <!--<xsl:value-of select="ns3:Location/ns3:Address/ns3:LineOne"/> -->
            </ns10:Element-166>
            </xsl:if>
             <xsl:if test='(string-length(ns3:Location/ns3:Address/ns3:LineTwo) &lt;= 55)'>
            <ns10:Element-166_1>
              <xsl:value-of select="ns3:Location/ns3:Address/ns3:LineTwo"/>
            </ns10:Element-166_1>
               </xsl:if>
                <xsl:if test='(string-length(ns3:Location/ns3:Address/ns3:LineTwo)  &gt; 55)'>
            <ns10:Element-166_1>
              <xsl:value-of select="concat(substring(ns3:Location/ns3:Address/ns3:LineTwo,1,54),'+')"/>
            </ns10:Element-166_1>
               </xsl:if>
          </ns10:Segment-N3> 
       
          </xsl:if>
          <!--ADDED AS ON 16 OCT -->
          <!-- Added the 55 character check on April-24- 2009-->
          <xsl:if test='(ns3:Location/ns3:Address/ns3:LineThree!="") or (ns3:Location/ns3:Address/ns3:LineFour != "")'>
            <ns10:Segment-N3>
              <xsl:if test='(string-length(ns3:Location/ns3:Address/ns3:LineThree) &lt;= 55)'>
            <ns10:Element-166>
              <xsl:value-of select="ns3:Location/ns3:Address/ns3:LineThree"/>
            </ns10:Element-166>
            </xsl:if>
             <xsl:if test='(string-length(ns3:Location/ns3:Address/ns3:LineThree) &gt; 55)'>
            <ns10:Element-166>
              <xsl:value-of select="concat(substring(ns3:Location/ns3:Address/ns3:LineThree,1,54),'+')"/>
             </ns10:Element-166>
            </xsl:if>
            <xsl:if test='(string-length(ns3:Location/ns3:Address/ns3:LineFour) &lt;= 55)'>
            <ns10:Element-166_1>
              <xsl:value-of select="ns3:Location/ns3:Address/ns3:LineFour"/>
            </ns10:Element-166_1>
            </xsl:if>
             <xsl:if test='(string-length(ns3:Location/ns3:Address/ns3:LineFour) &gt; 55)'>
            <ns10:Element-166>
              <xsl:value-of select="concat(substring(ns3:Location/ns3:Address/ns3:LineFour,1,54),'+')"/>
             </ns10:Element-166>
            </xsl:if>
         
            
          </ns10:Segment-N3> 
          </xsl:if>
          <xsl:if test="(ns3:Location/ns3:Address/ns3:CityName !='') or (ns3:Location/ns3:Address/ns3:PostalCode !='') or (ns3:Location/ns3:Address/ns3:CountryCode !='') or (ns3:Location/ns3:Address/ns3:CountrySubDivisionCode !='') or (ns3:Location/ns3:ID !='')">
          <ns10:Segment-N4>
          <xsl:if test="(ns3:Location/ns3:Address/ns3:CityName !='')">
            <ns10:Element-19>
              <xsl:value-of select="ns3:Location/ns3:Address/ns3:CityName"/>
            </ns10:Element-19>
            </xsl:if>
           <!-- <xsl:if test='((ns3:Location/ns3:Address/ns3:CountryCode = "US") or (ns3:Location/ns3:Address/ns3:CountryCode ="CA"))'>
              <ns10:Element-156>
                <xsl:value-of select="ns3:Location/ns3:Address/ns3:CountrySubDivisionCode"/>
              </ns10:Element-156>
            </xsl:if>--><!--Removed on 18 MAR-->
            <xsl:if test="(ns3:Location/ns3:Address/ns3:PostalCode !='')">
            <ns10:Element-116>
              <xsl:value-of select="ns3:Location/ns3:Address/ns3:PostalCode"/>
            </ns10:Element-116>
            </xsl:if>
            <xsl:if test="(ns3:Location/ns3:Address/ns3:CountryCode !='')">
            <ns10:Element-26_1>
              <xsl:value-of select="ns3:Location/ns3:Address/ns3:CountryCode"/>
            </ns10:Element-26_1>
            </xsl:if>
            <xsl:if test ="ns3:Location/ns3:ID !=''"> <!-- Added as on 3 Nov the "If" condition -->
            <ns10:Element-309_6>
              <xsl:value-of select='string("93")'/>
            </ns10:Element-309_6>
            <ns10:Element-310>
              <xsl:value-of select="ns3:Location/ns3:ID"/>
            </ns10:Element-310>
            </xsl:if>
             <!-- Added choose when condition on April-24 2009 to convert countrydivision name  to  3 digit code-->
            <!--<xsl:if test='((ns3:Location/ns3:Address/ns3:CountryCode != "US") and (ns3:Location/ns3:Address/ns3:CountryCode != "CA"))'>--><!--Removed on 18 MAR-->
         <!--   <xsl:if test="(ns3:Location/ns3:Address/ns3:CountrySubDivisionCode !='')"> -->
               <xsl:choose>
              <xsl:when test="(string-length(ns3:Location/ns3:Address/ns3:CountrySubDivisionCode) &lt;= 3)">
              <ns10:Element-1715>
              <!--Changed on April-22-->
               <xsl:value-of select='orcl:lookup-dvm("Country Subdivisions","Target",ns3:Location/ns3:Address/ns3:CountrySubDivisionCode,"EDICode",ns3:Location/ns3:Address/ns3:CountrySubDivisionCode)'/>
              <!--  <xsl:value-of select="ns3:Location/ns3:Address/ns3:CountrySubDivisionCode"/> -->
              </ns10:Element-1715>
              </xsl:when>
             <xsl:otherwise>
              <ns10:Element-1715>
                <xsl:value-of select='orcl:lookup-dvm("Country Subdivisions","Target",ns3:Location/ns3:Address/ns3:CountrySubDivisionCode,"EDICode","ZZZ")'/> 
              
              </ns10:Element-1715>
         </xsl:otherwise>
          </xsl:choose>
           <!--   </xsl:if> -->
            <!--</xsl:if>-->
          </ns10:Segment-N4> 
          </xsl:if>
          <xsl:if test='((ns3:BuyerContact/ns3:Name !="") or (ns3:BuyerContact/ns3:Communication[3]/ns3:DialNumber != "") or (ns3:BuyerContact/ns3:Communication[2]/ns3:DialNumber != "") or (ns3:BuyerContact/ns3:Communication[1]/ns3:URI != ""))'><!-- ADDED AS ON 4 DEC "NAME CONDITION" -->
           <ns10:Segment-PER_1><!-- ADDED AS ON 25 SEP -->
                <ns10:Element-366_1>
                  <xsl:value-of select='string("BD")'/>
                </ns10:Element-366_1>
              <xsl:if test='ns3:BuyerContact/ns3:Name !=""'>
              <ns10:Element-93>
                <xsl:value-of select="ns3:BuyerContact/ns3:Name"/>
              </ns10:Element-93>
              </xsl:if>  
              
             <xsl:if test='ns3:BuyerContact/ns3:Communication[3]/ns3:DialNumber != ""'>
                <ns10:Element-365_3>
                  <xsl:value-of select='string("TE")'/>
                </ns10:Element-365_3>
              <ns10:Element-364>
                <xsl:value-of select="ns3:BuyerContact/ns3:Communication[3]/ns3:DialNumber"/>
              </ns10:Element-364>
               </xsl:if>   
               
               <xsl:if test='ns3:BuyerContact/ns3:Communication[2]/ns3:DialNumber != ""'>
                <ns10:Element-365_4>
                  <xsl:value-of select='string("FX")'/>
                </ns10:Element-365_4>
              <ns10:Element-364_1>
                <xsl:value-of select="ns3:BuyerContact/ns3:Communication[2]/ns3:DialNumber"/>
              </ns10:Element-364_1>
               </xsl:if>    
               
             <xsl:if test='ns3:BuyerContact/ns3:Communication[1]/ns3:URI != ""'>
                <ns10:Element-365_5>
                  <xsl:value-of select='string("EM")'/>
                </ns10:Element-365_5>
                <ns10:Element-364_2>
                  <xsl:value-of select="ns3:BuyerContact/ns3:Communication[1]/ns3:URI"/>
                </ns10:Element-364_2>
             </xsl:if> <!-- ADDED AS ON 25 SEP -->
             
           </ns10:Segment-PER_1>
           </xsl:if>
        </ns10:Loop-N1>
      </xsl:for-each>
      
      <!--CARRIERPARTY-->
      <xsl:if test='ns3:PurchaseOrderHeader/ns3:CarrierParty/ns3:Name != ""'>
      <xsl:for-each select="ns3:PurchaseOrderHeader/ns3:CarrierParty">
        <ns10:Loop-N1>
        <xsl:if test="ns3:Name[1] != ''">
          <ns10:Segment-N1>
            <ns10:Element-98_3>
              <xsl:value-of select='string("CA")'/>
            </ns10:Element-98_3>
            <ns10:Element-93_1>
              <xsl:value-of select="substring(ns3:Name[1],1.0,60.0)"/>
            </ns10:Element-93_1>
          </ns10:Segment-N1>
          </xsl:if>
          <!--  Updated as per new mapping (Robin's email dated 21st Oct 2009) to set multiple "Name" fields from input --> 
          <!--<xsl:variable name="LENGTH_CA">  
                 <xsl:value-of select="string-length(ns3:Name)"/>
            </xsl:variable> 
            <xsl:if test="$LENGTH_CA > 60.0">-->   <!-- ADDED AS ON 8 OCT-->
         <xsl:if test="ns3:Name[2] != '' or ns3:Name[3] != ''">
          <ns10:Segment-N2>
            <xsl:if test="ns3:Name[2] != ''">
                <ns10:Element-93_1>
                  <xsl:value-of select="substring(ns3:Name[2],1.0,60.0)"/>
                </ns10:Element-93_1>
            </xsl:if>
            <xsl:if test="ns3:Name[3] != ''">          
                <ns10:Element-93>
                  <xsl:value-of select="substring(ns3:Name[3],1.0,60.0)"/>
                </ns10:Element-93>
          </xsl:if>
          </ns10:Segment-N2>          
          </xsl:if>
          <xsl:if test="ns3:Name[4] != '' or ns3:Name[5] != ''">
          <ns10:Segment-N2>
            <xsl:if test="ns3:Name[4] != ''">
                <ns10:Element-93_1>
                  <xsl:value-of select="substring(ns3:Name[4],1.0,60.0)"/>
                </ns10:Element-93_1>
            </xsl:if>
            <xsl:if test="ns3:Name[5] != ''">
                <ns10:Element-93>
                  <xsl:value-of select="substring(ns3:Name[5],1.0,60.0)"/>
                </ns10:Element-93>
            </xsl:if>
          </ns10:Segment-N2>
          </xsl:if>          
          <!--  Updated as per new mapping (Robin's email dated 21st Oct 2009) to set multiple "Name" fields from input -->
        </ns10:Loop-N1>
      </xsl:for-each>
      </xsl:if>
      <ns10:Loop-PO1>
        <xsl:for-each select="ns3:PurchaseOrderLine">
          <ns10:Segment-PO1>
            <ns10:Element-350_1>
              <xsl:value-of select="ns3:LineNumber"/>
            </ns10:Element-350_1>
            <ns10:Element-380_2>
              <xsl:value-of select="ns3:Quantity"/>
            </ns10:Element-380_2>
            <!--<ns10:Element-355_1>
              <xsl:value-of select="ns3:Quantity/@unitCode"/>
            </ns10:Element-355_1>-->
            
             <xsl:if test="ns3:Quantity/@unitCode !=''">
            <ns10:Element-355>
              <!--<xsl:value-of select="imp1:Quantity/@unitCode"/>-->
              <xsl:value-of select='orcl:lookup-dvm("UnitOfMeasure","Target",ns3:Quantity/@unitCode,"EDI",ns3:Quantity/@unitCode)'/>
            </ns10:Element-355>
            </xsl:if>
            <xsl:if test="ns3:Quantity/@unitCode =''">
            <ns10:Element-355>
              <xsl:value-of select="ns3:Quantity/@unitCode"/>
            </ns10:Element-355>
            </xsl:if>
            <!-- <ns10:Element-355_1>
              <xsl:value-of select="ns3:Item/ns3:Packaging/ns3:ID"/>
            </ns10:Element-355_1> -->
            <!-- removed as per robin's mail on 23 Sep -->
         <!--   <ns10:Element-212>
              <xsl:value-of select="ns3:UnitPrice/ns3:Amount"/>
            </ns10:Element-212> -->
            
              <xsl:variable name="amount">  
                <xsl:value-of select="string(number(ns3:UnitPrice/ns3:Amount))"/>
            </xsl:variable> 
            <xsl:choose>
              <xsl:when test="(ns3:UnitPrice/ns3:Amount = '') or ceiling(ns3:UnitPrice/ns3:Amount) = 0">
                  <ns10:Element-212_1>
                     <xsl:value-of select="string('0')"/>
                  </ns10:Element-212_1>
              </xsl:when>
              <xsl:when test="starts-with($amount,'0')">
              <ns10:Element-212_1>
                 <xsl:value-of select="substring-after($amount,'0')"/>
              </ns10:Element-212_1>
              </xsl:when>
              <xsl:otherwise>
               <ns10:Element-212_1>
                 <xsl:value-of select="$amount"/>
               </ns10:Element-212_1>
              </xsl:otherwise>
            </xsl:choose>
            
            <xsl:if test="ns3:Item/ns3:ItemID/ns3:ID !=''"> <!--ADDED AS ON 09 FEB 2009 -->
            <ns10:Element-235_15>
              <xsl:value-of select='string("SW")'/>
            </ns10:Element-235_15>
            <ns10:Element-234_1>
              <xsl:value-of select="ns3:Item/ns3:ItemID/ns3:ID"/>
            </ns10:Element-234_1>
            </xsl:if>
            <xsl:if test='ns3:Item/ns3:SupplierItemID/ns3:ID != ""'> <!--ADDED AS ON 25 SEP -->
            <ns10:Element-235_16>
              <xsl:value-of select='string("VX")'/>
            </ns10:Element-235_16>
            <ns10:Element-234_2>
              <xsl:value-of select="ns3:Item/ns3:SupplierItemID/ns3:ID"/>
            </ns10:Element-234_2>
            </xsl:if>
            <xsl:if test='ns3:Item/ns3:ItemID/ns3:RevisionID != ""'>  <!--ADDED AS ON 25 SEP -->
            <ns10:Element-235_17>
              <xsl:value-of select='string("BE")'/>
            </ns10:Element-235_17>
            <ns10:Element-234_3>
              <xsl:value-of select="ns3:Item/ns3:ItemID/ns3:RevisionID"/>
            </ns10:Element-234_3>
            </xsl:if>
          </ns10:Segment-PO1>       
        
        <xsl:variable name="Desc_Len_Var">  
                <xsl:value-of select="string-length(ns3:Item/ns3:Description)"/>
              </xsl:variable>
               <xsl:variable name="Desc_Var">  
                <xsl:value-of select="ns3:Item/ns3:Description"/>
              </xsl:variable>
              <xsl:variable name="No_of_loops">  
                <xsl:value-of select="ceiling($Desc_Len_Var div '80')"/>
              </xsl:variable>

              <!-- 02 Oct 2009 SC_Phase3 - Updated to have "for" loop for Segment-PID (and not Loop-PID). 
                                Also moved MEA segment within Loop-PID -->
         
	        <ns10:Loop-PID>
                  <xsl:for-each select="(//node())[position() &lt;= $No_of_loops]">
                  <xsl:variable name="Position">  
                    <xsl:value-of select="position()"/>
                  </xsl:variable>
                   <xsl:variable name="Var3">
                    <xsl:value-of select="substring($Desc_Var,(($Position * 80) - 79),80)"/>
                  </xsl:variable>
                    <ns10:Segment-PID_1>
                      <ns10:Element-349_2>
                        <xsl:value-of select='string("F")'/>
                      </ns10:Element-349_2>
                      <ns10:Element-352_3>
                        <!--<xsl:value-of select="imp1:Item/imp1:Description"/>-->
                        <xsl:value-of select="$Var3"/>
                      </ns10:Element-352_3>
                    </ns10:Segment-PID_1>
                    </xsl:for-each>
                    <!-- ADDED AS ON 23 OCT "MEA SEGEMENT WITH THE IF CONDITION" -->
                    <!--<xsl:if test="/imp1:CustomChangePO/ChangePO/ns3:ApplicationArea/ns3:Sender/ns3:LogicalID ='LIEBERTNA'">-->
                    <xsl:if test="ns3:Item/ns3:Specification/ns3:Property/ns3:NameValue != ''"> 
                    <ns10:Segment-MEA_1>
                      <ns10:Element-737_1>
                        <xsl:value-of select='string("WT")'/>
                      </ns10:Element-737_1>
                      <ns10:Element-738_1>
                        <xsl:value-of select='string("U")'/>
                      </ns10:Element-738_1>
                      <ns10:Element-739_1>
                        <xsl:value-of select="ns3:Item/ns3:Specification/ns3:Property/ns3:NameValue"/>
                      </ns10:Element-739_1>
                      <ns10:Composite-C001_1>
                        <ns10:Element-355>
                          <xsl:value-of select="ns3:Item/ns3:Specification/ns3:Property/ns3:NameValue/@unitCode"/>
                        </ns10:Element-355>
                      </ns10:Composite-C001_1>
                    </ns10:Segment-MEA_1> 
                    </xsl:if>
                    <!--</xsl:if> -->
                  </ns10:Loop-PID>
		<!-- 02 Oct 2009 SC_Phase3 -->
        
        <xsl:if test='(ns3:Item/ns3:Classification/ns3:Codes/ns3:Code[1] != "") and (ns3:Item/ns3:Classification/ns3:Codes/ns3:Code[1]/@name = "HTS Code")'>
        <ns10:Segment-TC2_1>    
            <ns10:Element-23_2>
              <xsl:value-of select='string("A")'/>
            </ns10:Element-23_2>
            <ns10:Element-22>
              <xsl:value-of select='ns3:Item/ns3:Classification/ns3:Codes/ns3:Code[1]'/>
            </ns10:Element-22>
         </ns10:Segment-TC2_1>
         </xsl:if>
         
        <xsl:if test='(ns3:Item/ns3:Classification/ns3:Codes/ns3:Code[2] != "") and (ns3:Item/ns3:Classification/ns3:Codes/ns3:Code[2]/@name = "Emerson Commodity Code")'>
        <ns10:Segment-TC2_1>    
            <ns10:Element-23_2>
              <xsl:value-of select='string("Z")'/>
            </ns10:Element-23_2>
            <ns10:Element-22>
              <xsl:value-of select='ns3:Item/ns3:Classification/ns3:Codes/ns3:Code[2]'/>
            </ns10:Element-22>
        </ns10:Segment-TC2_1>
        </xsl:if> 
        
        
        <xsl:if test='ns3:Item/ns3:HazardousMaterial/ns3:ID != ""'>
        <ns10:Segment-TD4_1>
            <ns10:Element-152_1>
              <xsl:value-of select='string("HAZ")'/>
            </ns10:Element-152_1>
            <ns10:Element-352_3>
              <xsl:value-of select="ns3:Item/ns3:HazardousMaterial/ns3:ID"/>
            </ns10:Element-352_3>
           </ns10:Segment-TD4_1>
            </xsl:if>
            
            <xsl:if test='(ns3:Note[1] != "") or (ns3:Note[2] != "")'>
        <!--<ns10:Loop-LDT>-->     <!-- Removed Loop-LDT and updated Segment-MTX to use value within Loop-PO1 18-Sep SC_Phase3 -->
                     <ns10:Segment-MTX_2>
                        <ns10:Element-363_2>
                            <xsl:value-of select='string("ORI")'/>
                        </ns10:Element-363_2>
                        <xsl:if test='ns3:Note[1] != ""'>
                        <ns10:Element-1551_2>
                             <xsl:value-of select='ns3:Note[1]'/>
                        </ns10:Element-1551_2>
                        </xsl:if>
                        <xsl:if test='ns3:Note[2] != ""'>
                        <ns10:Element-1551>
                            <xsl:value-of select='ns3:Note[2]'/>
                        </ns10:Element-1551>
                        </xsl:if>
                    </ns10:Segment-MTX_2>
        <!--</ns10:Loop-LDT>--> <!-- Removed Loop-LDT and updated Segment-MTX to use value within Loop-PO1 18-Sep SC_Phase3 -->
        </xsl:if>
        
        
         <!--SHIPTO--><!-- ADDED AS ON 16 OCT -->
        <xsl:for-each select="ns3:PurchaseOrderSchedule">
       <ns10:Loop-N1_2>
       <xsl:if test="ns3:UserArea/ns3:ShipToParty/ns3:Name[1] != ''">
        <ns10:Segment-N1_2>
          <ns10:Element-98_4>
              <xsl:value-of select='string("ST")'/>
            </ns10:Element-98_4>
            <ns10:Element-93_1>
              <xsl:value-of select="substring(ns3:UserArea/ns3:ShipToParty/ns3:Name[1],1.0,60.0)"/>
            </ns10:Element-93_1>
            <ns10:Element-66_2>
              <xsl:value-of select='string("93")'/>
            </ns10:Element-66_2>
            <ns10:Element-67_1>
              <xsl:value-of select="ns3:UserArea/ns3:ShipToParty/ns3:PartyIDs/ns3:ID"/>
            </ns10:Element-67_1>
          </ns10:Segment-N1_2>
        </xsl:if>
         <!--  Updated as per new mapping (Robin's email dated 21st Oct 2009) to set multiple "Name" fields from input --> 
          <!--<xsl:variable name="LENGTH_ST">  
                 <xsl:value-of select="string-length(ns3:UserArea/ns3:ShipToParty/ns3:Name)"/>
          </xsl:variable> 
            <xsl:if test="$LENGTH_ST > 60.0">-->   <!-- ADDED AS ON 8 OCT-->
         <xsl:if test="ns3:UserArea/ns3:ShipToParty/ns3:Name[2] != '' or ns3:UserArea/ns3:ShipToParty/ns3:Name[3] != ''">
          <ns10:Segment-N2>
            <xsl:if test="ns3:UserArea/ns3:ShipToParty/ns3:Name[2] != ''">
                <ns10:Element-93_1>
                  <xsl:value-of select="substring(ns3:UserArea/ns3:ShipToParty/ns3:Name[2],1.0,60.0)"/>
                </ns10:Element-93_1>
            </xsl:if>
            <xsl:if test="ns3:UserArea/ns3:ShipToParty/ns3:Name[3] != ''">          
                <ns10:Element-93>
                  <xsl:value-of select="substring(ns3:UserArea/ns3:ShipToParty/ns3:Name[3],1.0,60.0)"/>
                </ns10:Element-93>
          </xsl:if>
          </ns10:Segment-N2>          
          </xsl:if>
          <xsl:if test="ns3:UserArea/ns3:ShipToParty/ns3:Name[4] != '' or ns3:UserArea/ns3:ShipToParty/ns3:Name[5] != ''">
          <ns10:Segment-N2>
            <xsl:if test="ns3:UserArea/ns3:ShipToParty/ns3:Name[4] != ''">
                <ns10:Element-93_1>
                  <xsl:value-of select="substring(ns3:UserArea/ns3:ShipToParty/ns3:Name[4],1.0,60.0)"/>
                </ns10:Element-93_1>
            </xsl:if>
            <xsl:if test="ns3:UserArea/ns3:ShipToParty/ns3:Name[5] != ''">
                <ns10:Element-93>
                  <xsl:value-of select="substring(ns3:UserArea/ns3:ShipToParty/ns3:Name[5],1.0,60.0)"/>
                </ns10:Element-93>
            </xsl:if>
          </ns10:Segment-N2>
          </xsl:if>          
          <!--  Updated as per new mapping (Robin's email dated 21st Oct 2009) to set multiple "Name" fields from input --> 
            <!-- Added the 55 character check on April-24- 2009-->
             <xsl:if test='(ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:LineOne!="") or (ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:LineTwo != "")'>
            <ns10:Segment-N3>
             <xsl:if test='(string-length(ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:LineOne) &lt;= 55)'>
            <ns10:Element-166>
              <xsl:value-of select="ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:LineOne"/>
            </ns10:Element-166>
            </xsl:if>
            <xsl:if test='(string-length(ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:LineOne) &gt; 55)'>
            <ns10:Element-166>
               <xsl:value-of select="concat(substring(ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:LineOne,1,54),'+')"/>
            </ns10:Element-166>
            </xsl:if>
            <xsl:if test='(string-length(ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:LineTwo) &lt;= 55)'>
            <ns10:Element-166_1>
              <xsl:value-of select="ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:LineTwo"/>
            </ns10:Element-166_1>
            </xsl:if>
             <xsl:if test='(string-length(ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:LineTwo) &gt; 55)'>
            <ns10:Element-166_1>
              <xsl:value-of select="concat(substring(ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:LineTwo,1,54),'+')"/>
            </ns10:Element-166_1>
            </xsl:if>
          </ns10:Segment-N3> 
          </xsl:if>
          <!--ADDED AS ON 16 OCT -->
          <!-- Added the 55 character check on April-24- 2009-->
               <xsl:if test='(ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:LineThree!="") or (ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:LineFour != "")'>
              <ns10:Segment-N3>
              <xsl:if test='(string-length(ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:LineThree) &lt;= 55)'>
                <ns10:Element-166>
                  <xsl:value-of select="ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:LineThree"/>
                </ns10:Element-166>
                </xsl:if>
                <xsl:if test='(string-length(ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:LineThree) &gt; 55)'>
                <ns10:Element-166>
                 <xsl:value-of select="concat(substring(ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:LineThree,1,54),'+')"/>
                </ns10:Element-166>
                </xsl:if>
                 <xsl:if test='(string-length(ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:LineFour) &lt;= 55)'>
                <ns10:Element-166_1>
                  <xsl:value-of select="ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:LineFour"/>
                </ns10:Element-166_1>
                </xsl:if>
                <xsl:if test='(string-length(ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:LineFour) &gt; 55)'>
                <ns10:Element-166_1>
                  <xsl:value-of select="concat(substring(ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:LineFour,1,54),'+')"/>
                </ns10:Element-166_1>
                </xsl:if>
              </ns10:Segment-N3>
            </xsl:if>
          <xsl:if test="(ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:CityName !='') or (ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:PostalCode !='') or (ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:CountryCode !='') or (ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:CountrySubDivisionCode !='') or (ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:ID !='')">
           <ns10:Segment-N4><!-- ADDED AS ON 23 OCT -->
           <xsl:if test="(ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:CityName !='')">
            <ns10:Element-19>
              <xsl:value-of select="ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:CityName"/>
            </ns10:Element-19>
            </xsl:if>
           <!-- <xsl:if test='((ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:CountryCode ="US") or (ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:CountryCode ="CA"))'>
              <ns10:Element-156>
                <xsl:value-of select="ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:CountrySubDivisionCode"/>
              </ns10:Element-156>
            </xsl:if>--><!--Removed on 18 MAR-->
            <xsl:if test="(ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:PostalCode !='')">
            <ns10:Element-116>
              <xsl:value-of select="ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:PostalCode"/>
            </ns10:Element-116>
            </xsl:if>
            <xsl:if test="(ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:CountryCode !='')">
            <ns10:Element-26_1>
              <xsl:value-of select="ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:CountryCode"/>
            </ns10:Element-26_1>
            </xsl:if>
            <xsl:if test ="ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:ID !=''"> <!-- Added as on 3 Nov the "If" condition -->
            <ns10:Element-309_6>
              <xsl:value-of select="string(93.0)"/>
            </ns10:Element-309_6>
            <ns10:Element-310>
              <xsl:value-of select="ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:ID"/>
            </ns10:Element-310>
            </xsl:if>
           <!-- <xsl:if test='((ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:CountryCode != "US") and (ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:CountryCode !="CA"))'>--><!--Removed on 18 MAR-->
          <!-- Added choose when condition on April-24 2009 to convert countrydivision name  to  3 digit code-->
         <!--   <xsl:if test="(ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:CountrySubDivisionCode !='')"> -->
              <xsl:choose>
              <xsl:when test="(string-length(ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:CountrySubDivisionCode) &lt;= 3)">
              <ns10:Element-1715>
              <!--Changed on April-22-->
               <xsl:value-of select='orcl:lookup-dvm("Country Subdivisions","Target",ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:CountrySubDivisionCode,"EDICode",ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:CountrySubDivisionCode)'/>
              <!--  <xsl:value-of select="ns3:Location/ns3:Address/ns3:CountrySubDivisionCode"/> -->
              </ns10:Element-1715>
              </xsl:when>
              <xsl:otherwise>
             <ns10:Element-1715>
             <xsl:value-of select='orcl:lookup-dvm("Country Subdivisions","Target",ns3:UserArea/ns3:ShipToParty/ns3:Location/ns3:Address/ns3:CountrySubDivisionCode,"EDICode","ZZZ")'/>
             </ns10:Element-1715>
             </xsl:otherwise>
          </xsl:choose>
        <!--      </xsl:if> -->
            <!--</xsl:if>-->
          </ns10:Segment-N4>  
          </xsl:if>
           <!--Added as on 2 DEC-->
          <xsl:if test='((ns3:Note[1] !="") and (ns3:Note[1]/@author = "Emerson Location Identifier"))'>
          <ns10:Segment-REF_2>
            <ns10:Element-128_5>
              <xsl:value-of select='string("4C")'/>
            </ns10:Element-128_5>
            <ns10:Element-127_1>
              <xsl:value-of select="ns3:Note[1]"/>
            </ns10:Element-127_1>
          </ns10:Segment-REF_2>
        </xsl:if>
        <xsl:if test='((ns3:Note[2] !="") and (ns3:Note[2]/@author = "Kanban Card Number"))'>
          <ns10:Segment-REF_2>
            <ns10:Element-128_5>
              <xsl:value-of select='string("KE")'/>
            </ns10:Element-128_5>
            <ns10:Element-127_1>
              <xsl:value-of select="ns3:Note[2]"/>
            </ns10:Element-127_1>
          </ns10:Segment-REF_2>
    </xsl:if>   
    
       <xsl:if test='((ns3:UserArea/ns3:ShipToParty/ns3:Contact[1]/ns3:Name !="") or (ns3:UserArea/ns3:ShipToParty/ns3:Contact[1]/ns3:Communication[3]/ns3:DialNumber != "") or (ns3:UserArea/ns3:ShipToParty/ns3:Contact[1]/ns3:Communication[2]/ns3:DialNumber !="") or (ns3:UserArea/ns3:ShipToParty/ns3:Contact[1]/ns3:Communication[1]/ns3:URI != ""))'> 
        <ns10:Segment-PER_2>
            <ns10:Element-366_2>
              <xsl:value-of select='string("BD")'/>
            </ns10:Element-366_2>
            <xsl:if test='ns3:UserArea/ns3:ShipToParty/ns3:Contact[1]/ns3:Name !=""'>
            <ns10:Element-93>
              <xsl:value-of select="ns3:UserArea/ns3:ShipToParty/ns3:Contact[1]/ns3:Name"/>
            </ns10:Element-93>
            </xsl:if>
            
            <xsl:if test="ns3:UserArea/ns3:ShipToParty/ns3:Contact[1]/ns3:Communication[3]/ns3:DialNumber != ''"> 
            <ns10:Element-365_3>
              <xsl:value-of select='string("TE")'/>
            </ns10:Element-365_3>
            <ns10:Element-364>
              <xsl:value-of select="ns3:UserArea/ns3:ShipToParty/ns3:Contact[1]/ns3:Communication[3]/ns3:DialNumber"/>
            </ns10:Element-364>
           </xsl:if> 
           
            <xsl:if test="ns3:UserArea/ns3:ShipToParty/ns3:Contact[1]/ns3:Communication[2]/ns3:DialNumber !='' ">
            <ns10:Element-365_4>
              <xsl:value-of select='string("FX")'/>
            </ns10:Element-365_4>
            <ns10:Element-364_1>
              <xsl:value-of select="ns3:UserArea/ns3:ShipToParty/ns3:Contact[1]/ns3:Communication[2]/ns3:DialNumber"/> 
            </ns10:Element-364_1>
           </xsl:if>
           
            <xsl:if test='ns3:UserArea/ns3:ShipToParty/ns3:Contact[1]/ns3:Communication[1]/ns3:URI != ""'>
            <ns10:Element-365_5>
              <xsl:value-of select='string("EM")'/>
            </ns10:Element-365_5>
            <ns10:Element-364_2>
              <xsl:value-of select="ns3:UserArea/ns3:ShipToParty/ns3:Contact[1]/ns3:Communication[1]/ns3:URI"/>
            </ns10:Element-364_2>
            </xsl:if>
          </ns10:Segment-PER_2>
        </xsl:if>
        <xsl:if test='ns3:UserArea/ns3:BuyerContact/ns3:Name !=""'>  <!--Added on 18 MAR-->
            <ns10:Segment-PER_2>
             <ns10:Element-366_2>
              <xsl:value-of select='string("RQ")'/>
            </ns10:Element-366_2>
            <ns10:Element-93>
              <xsl:value-of select="ns3:UserArea/ns3:BuyerContact/ns3:Name"/>
            </ns10:Element-93>
            </ns10:Segment-PER_2>
           </xsl:if> 
        <!--<ns10:Loop-SCH>--> <!-- Removed Loop-SCH and updated Segment-SCH to use value within Loop-N1_2 05-Oct SC_Phase3 -->
          <ns10:Segment-SCH_1>
            <ns10:Element-380_2>
              <xsl:value-of select="ns3:Quantity"/>
            </ns10:Element-380_2>
           <!-- <ns10:Element-355>
              <xsl:value-of select="ns3:Quantity/@unitCode"/>
            </ns10:Element-355>-->
             <xsl:if test="ns3:Quantity/@unitCode !=''">
            <ns10:Element-355>
             <!-- <xsl:value-of select="imp1:Quantity/@unitCode"/>-->
             <xsl:value-of select='orcl:lookup-dvm("UnitOfMeasure","Target",ns3:Quantity/@unitCode,"EDI",ns3:Quantity/@unitCode)'/>
            </ns10:Element-355>
            </xsl:if>
            <xsl:if test="ns3:Quantity/@unitCode =''">
            <ns10:Element-355>
               <xsl:value-of select="ns3:Quantity/@unitCode"/>
            </ns10:Element-355>
            </xsl:if>
            
          <!--  <xsl:if test="ns3:RequiredDeliveryDateTime !=''">
            <ns10:Element-374_5>
              <xsl:value-of select="string('112')"/>
            </ns10:Element-374_5>
            <ns10:Element-373>
             <xsl:value-of select="concat(substring(ns3:RequiredDeliveryDateTime,1.0,4.0),substring(ns3:RequiredDeliveryDateTime,6.0,2.0),substring(ns3:RequiredDeliveryDateTime,9.0,2.0))"/> 
            </ns10:Element-373>
            </xsl:if>
            <xsl:if test="ns3:UserArea/ns3:RequestedShipDateTime !=''">
            <ns10:Element-374>
              <xsl:value-of select="string('010')"/>
            </ns10:Element-374>
            <ns10:Element-373_1>
             <xsl:value-of select="concat(substring(ns3:UserArea/ns3:RequestedShipDateTime,1.0,4.0),substring(ns3:UserArea/ns3:RequestedShipDateTime,6.0,2.0),substring(ns3:UserArea/ns3:RequestedShipDateTime,9.0,2.0))"/> 
            </ns10:Element-373_1>
            </xsl:if>-->
            
               <xsl:choose>
            <xsl:when test="ns3:RequiredDeliveryDateTime !=''">
            <ns10:Element-374_7>
              <xsl:value-of select="string('112')"/>
            </ns10:Element-374_7>
            <ns10:Element-373>
             <xsl:value-of select="concat(substring(ns3:RequiredDeliveryDateTime,1.0,4.0),substring(ns3:RequiredDeliveryDateTime,6.0,2.0),substring(ns3:RequiredDeliveryDateTime,9.0,2.0))"/> <!-- ADDED AS ON 29SEP -->
            </ns10:Element-373>
            </xsl:when>
            
            <xsl:when test="(ns3:RequiredDeliveryDateTime ='') and (ns3:UserArea/ns3:RequestedShipDateTime !='')">
            <ns10:Element-374_7>
              <xsl:value-of select="string('112')"/>
            </ns10:Element-374_7>
            <ns10:Element-373>
             <xsl:value-of select="concat(substring(ns3:UserArea/ns3:RequestedShipDateTime,1.0,4.0),substring(ns3:UserArea/ns3:RequestedShipDateTime,6.0,2.0),substring(ns3:UserArea/ns3:RequestedShipDateTime,9.0,2.0))"/> <!-- ADDED AS ON 22 OCT -->
            </ns10:Element-373>
            </xsl:when>
            
            <xsl:when test="(ns3:RequiredDeliveryDateTime ='') and (ns3:UserArea/ns3:RequestedShipDateTime ='')">
            <ns10:Element-374_7>
              <xsl:value-of select="string('112')"/>
            </ns10:Element-374_7>
            <ns10:Element-373>
             <xsl:value-of select="concat(substring($Current_date,1.0,4.0),substring($Current_date,6.0,2.0),substring($Current_date,9.0,2.0))"/><!-- ADDED AS ON 22 OCT -->
            </ns10:Element-373>
            </xsl:when>
            </xsl:choose>
            <xsl:if test="ns3:UserArea/ns3:RequestedShipDateTime !=''">
            <ns10:Element-374_8>
              <xsl:value-of select="string('010')"/>
            </ns10:Element-374_8>
            <ns10:Element-373_1>
             <xsl:value-of select="concat(substring(ns3:UserArea/ns3:RequestedShipDateTime,1.0,4.0),substring(ns3:UserArea/ns3:RequestedShipDateTime,6.0,2.0),substring(ns3:UserArea/ns3:RequestedShipDateTime,9.0,2.0))"/> <!-- ADDED AS ON 22 OCT -->
            </ns10:Element-373_1>
            </xsl:if>
      
            <ns10:Element-350_1>
              <xsl:value-of select="ns3:LineNumber"/>
            </ns10:Element-350_1>
          </ns10:Segment-SCH_1>
        <!--</ns10:Loop-SCH>--> <!-- Removed Loop-SCH and updated Segment-SCH to use value within Loop-N1_2 05-Oct SC_Phase3 -->
            </ns10:Loop-N1_2> 
          </xsl:for-each> <!-- ADDED AS ON 16 OCT -->     
         </xsl:for-each>
      </ns10:Loop-PO1> 
        <ns10:Loop-CTT> 
          <ns10:Segment-CTT>
            <ns10:Element-354>
              <xsl:value-of select="count(ns3:PurchaseOrderLine)"/>
            </ns10:Element-354>
          </ns10:Segment-CTT>
        </ns10:Loop-CTT>      
        <ns10:Segment-SE>
            <ns10:Element-96>
                <xsl:value-of select='string("#SegmentCount#")'/>
            </ns10:Element-96>
            <!--<ns10:Element-329>
                <xsl:value-of select="orcl:lookup-table('SC_MASTER_TRANSACTION','FLOW_ID_1',$flowID,'ST_CONTROL','jdbc:polite4:system/any@142.176.225.81:1531:OraESB')"/>
            </ns10:Element-329> -->
            <ns10:Element-329>
              <!--<xsl:value-of select="string('#ControlNumber#')"/>-->
              <xsl:value-of select="$SC_SeqNo"/>
            </ns10:Element-329>
        </ns10:Segment-SE>
      </xsl:for-each>  
      <!--Added on 15 DEC-->
      <!---<ns10:Segment-GE>
        <ns10:Element-97>
          <xsl:value-of select="count(/imp1:CustomChangePO/ChangePO/DataArea/ns3:PurchaseOrder)"/>
        </ns10:Element-97>
      </ns10:Segment-GE>-->
    </ns10:Transaction-850>
    
     <Message_id>
        <xsl:value-of select="/imp1:CustomChangePO/Message_id"/>
      </Message_id>
      <Message_direction>
        <xsl:value-of select="/imp1:CustomChangePO/Message_direction"/>
      </Message_direction>
      <Sender_Document_number>
        <xsl:value-of select="/imp1:CustomChangePO/Sender_Document_number"/>
      </Sender_Document_number>
      <Sender_Message_type>
        <xsl:value-of select="/imp1:CustomChangePO/Sender_Message_type"/>
      </Sender_Message_type>
      <Sender_Message_standard>
        <xsl:value-of select="/imp1:CustomChangePO/Sender_Message_standard"/>
      </Sender_Message_standard>
      <Sender_Transaction_type>
        <xsl:value-of select="/imp1:CustomChangePO/Sender_Transaction_type"/>
      </Sender_Transaction_type>
      <Sender_Transaction_subtype>
        <xsl:value-of select="/imp1:CustomChangePO/Sender_Transaction_subtype"/>
      </Sender_Transaction_subtype>
      <Sender_System_type>
        <xsl:value-of select="/imp1:CustomChangePO/Sender_System_type"/>
      </Sender_System_type>
      <Sender_Id>
        <xsl:value-of select="/imp1:CustomChangePO/Sender_Id"/>
      </Sender_Id>
      <Sender_Site_Id>
        <xsl:value-of select="/imp1:CustomChangePO/Sender_Site_Id"/>
      </Sender_Site_Id>
      <Sender_Name>
        <xsl:value-of select="/imp1:CustomChangePO/Sender_Name"/>
      </Sender_Name>
      <Sender_Type>
        <xsl:value-of select="/imp1:CustomChangePO/Sender_Type"/>
      </Sender_Type>
      <Receiver_System_type>
        <xsl:value-of select="/imp1:CustomChangePO/Receiver_System_type"/>
      </Receiver_System_type>
      <Receiver_Id>
        <xsl:value-of select="/imp1:CustomChangePO/Receiver_Id"/>
      </Receiver_Id>
      <Receiver_Site_id>
        <xsl:value-of select="/imp1:CustomChangePO/Receiver_Site_id"/>
      </Receiver_Site_id>
      <Receiver_Name>
        <xsl:value-of select="/imp1:CustomChangePO/Receiver_Name"/>
      </Receiver_Name>
      <Receiver_type>
        <xsl:value-of select="/imp1:CustomChangePO/Receiver_type"/>
      </Receiver_type>
      <File_name>
        <xsl:value-of select="/imp1:CustomChangePO/File_name"/>
      </File_name>
      <Record_total>
        <xsl:value-of select="/imp1:CustomChangePO/Record_total"/>
      </Record_total>
      <Record_number>
        <xsl:value-of select="/imp1:CustomChangePO/Record_number"/>
      </Record_number>
      <Flow_id_1>
        <xsl:value-of select="/imp1:CustomChangePO/Flow_id_1"/>
      </Flow_id_1>
      <Flow_id_2>
        <xsl:value-of select="/imp1:CustomChangePO/Flow_id_2"/>
      </Flow_id_2>
      <Flow_id_3>
        <xsl:value-of select="/imp1:CustomChangePO/Flow_id_3"/>
      </Flow_id_3>
      <Send_on_fail>
        <xsl:value-of select="/imp1:CustomChangePO/Send_on_fail"/>
      </Send_on_fail>
      <Division_name>
        <xsl:value-of select="/imp1:CustomChangePO/Division_name"/>
      </Division_name>
      <Division_format>
        <xsl:value-of select="/imp1:CustomChangePO/Division_format"/>
      </Division_format>
      <Trading_partner_1_name>
        <xsl:value-of select="/imp1:CustomChangePO/Trading_partner_1_name"/>
      </Trading_partner_1_name>
      <Trading_partner_1_format>
        <xsl:value-of select="/imp1:CustomChangePO/Trading_partner_1_format"/>
      </Trading_partner_1_format>
      <Trading_partner_1_date_from>
        <xsl:value-of select="/imp1:CustomChangePO/Trading_partner_1_date_from"/>
      </Trading_partner_1_date_from>
      <Trading_partner_1_date_to>
        <xsl:value-of select="/imp1:CustomChangePO/Trading_partner_1_date_to"/>
      </Trading_partner_1_date_to>
      <Trading_partner_2_name>
        <xsl:value-of select="/imp1:CustomChangePO/Trading_partner_2_name"/>
      </Trading_partner_2_name>
      <Trading_partner_2_format>
        <xsl:value-of select="/imp1:CustomChangePO/Trading_partner_2_format"/>
      </Trading_partner_2_format>
      <Trading_partner_2_date_from>
        <xsl:value-of select="/imp1:CustomChangePO/Trading_partner_2_date_from"/>
      </Trading_partner_2_date_from>
      <Trading_partner_2_date_to>
        <xsl:value-of select="/imp1:CustomChangePO/Trading_partner_2_date_to"/>
      </Trading_partner_2_date_to>
      <Trading_partner_3_name>
        <xsl:value-of select="/imp1:CustomChangePO/Trading_partner_3_name"/>
      </Trading_partner_3_name>
      <Trading_partner_3_format>
        <xsl:value-of select="/imp1:CustomChangePO/Trading_partner_3_format"/>
      </Trading_partner_3_format>
      <Trading_partner_3_date_from>
        <xsl:value-of select="/imp1:CustomChangePO/Trading_partner_3_date_from"/>
      </Trading_partner_3_date_from>
      <Trading_partner_3_date_to>
        <xsl:value-of select="/imp1:CustomChangePO/Trading_partner_3_date_to"/>
      </Trading_partner_3_date_to>
      <Logistics_1_name>
        <xsl:value-of select="/imp1:CustomChangePO/Logistics_1_name"/>
      </Logistics_1_name>
      <Logistics_1_format>
        <xsl:value-of select="/imp1:CustomChangePO/Logistics_1_format"/>
      </Logistics_1_format>
      <Logistics_1_date_from>
        <xsl:value-of select="/imp1:CustomChangePO/Logistics_1_date_from"/>
      </Logistics_1_date_from>
      <Logistics_1_date_to>
        <xsl:value-of select="/imp1:CustomChangePO/Logistics_1_date_to"/>
      </Logistics_1_date_to>
      <Logistics_2_name>
        <xsl:value-of select="/imp1:CustomChangePO/Logistics_2_name"/>
      </Logistics_2_name>
      <Logistics_2_format>
        <xsl:value-of select="/imp1:CustomChangePO/Logistics_2_format"/>
      </Logistics_2_format>
      <Logistics_2_date_from>
        <xsl:value-of select="/imp1:CustomChangePO/Logistics_2_date_from"/>
      </Logistics_2_date_from>
      <Logistics_2_date_to>
        <xsl:value-of select="/imp1:CustomChangePO/Logistics_2_date_to"/>
      </Logistics_2_date_to>
      <Logistics_3_name>
        <xsl:value-of select="/imp1:CustomChangePO/Logistics_3_name"/>
      </Logistics_3_name>
      <Logistics_3_format>
        <xsl:value-of select="/imp1:CustomChangePO/Logistics_3_format"/>
      </Logistics_3_format>
      <Logistics_3_date_from>
        <xsl:value-of select="/imp1:CustomChangePO/Logistics_3_date_from"/>
      </Logistics_3_date_from>
      <Logistics_3_date_to>
        <xsl:value-of select="/imp1:CustomChangePO/Logistics_3_date_to"/>
      </Logistics_3_date_to>
      <Compliance_result>
        <xsl:value-of select="/imp1:CustomChangePO/Compliance_result"/>
      </Compliance_result>
      <Attribute1>
        <xsl:value-of select="/imp1:CustomChangePO/Attribute1"/>
      </Attribute1>
      <Attribute2>
        <xsl:value-of select="/imp1:CustomChangePO/Attribute2"/>
      </Attribute2>
      <Attribute3>
        <xsl:value-of select="/imp1:CustomChangePO/Attribute3"/>
      </Attribute3>
      <Attribute4>
        <xsl:value-of select="/imp1:CustomChangePO/Attribute4"/>
      </Attribute4>
      <Attribute5>
        <xsl:value-of select="/imp1:CustomChangePO/Attribute5"/>
      </Attribute5>
      <Attribute6>
      <xsl:value-of select="$SC_SeqNo"/>
     <!--   <xsl:value-of select="/imp1:CustomChangePO/Attribute6"/> -->
      </Attribute6>      
      <Attribute7>
        <xsl:value-of select="concat($destination, '_860_', xp20:format-dateTime(xp20:current-dateTime(),'[Y04][M01][D01]_[H01][m01][s01]'),$SC_SeqNo,'.dat')"/>
      </Attribute7>
      <Attribute8>
        <xsl:value-of select="/imp1:CustomChangePO/Attribute8"/>
      </Attribute8>
      <Attribute9>
        <xsl:value-of select="/imp1:CustomChangePO/Attribute9"/>
      </Attribute9>
      <Attribute10>
        <xsl:value-of select="/imp1:CustomChangePO/Attribute10"/>
      </Attribute10>
    </ns11:CustomEDI850>
  </xsl:template>
</xsl:stylesheet>